const CACHE_NAME="dicoding-story-v1",urlsToCache=["/","/manifest.json","/icons/icon-152x152.png","/icons/icon-192x192.png","/icons/icon-32x32.png","/icons/icon-16x16.png","/src/styles/main.css"];self.addEventListener("install",(e=>{console.log("Service Worker menginstal..."),e.waitUntil(caches.open(CACHE_NAME).then((e=>{console.log("Cache dibuka");const t=urlsToCache.filter((e=>!e.startsWith("http")));return e.addAll(t)})).catch((e=>(console.error("Gagal meng-cache sumber daya saat instalasi:",e),Promise.resolve())))),self.skipWaiting()})),self.addEventListener("activate",(e=>{console.log("Service Worker mengaktifkan..."),e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(e!==CACHE_NAME)return console.log("Menghapus cache lama:",e),caches.delete(e)})))))),self.clients.claim()})),self.addEventListener("fetch",(e=>{const t=new URL(e.request.url);t.origin!==location.origin||"chrome-extension:"===t.protocol||t.href.includes("story-app.dicoding.dev")||t.href.includes("openstreetmap.org")||t.href.includes("unpkg.com")||t.href.includes("cdnjs.cloudflare.com")||t.href.includes("sockjs-node")||t.href.includes("hot-update.js")?e.respondWith(fetch(e.request)):"navigate"!==e.request.mode&&"/"!==t.pathname&&"/index.html"!==t.pathname&&"/src/scripts/index.js"!==t.pathname&&"/src/scripts/app.js"!==t.pathname?e.respondWith(caches.match(e.request).then((t=>t?(console.log("[Service Worker] Cache-First: Menyajikan dari Cache:",e.request.url),fetch(e.request).then((t=>{t.ok&&caches.open(CACHE_NAME).then((n=>{n.put(e.request,t)}))})),t):(console.log("[Service Worker] Cache-First: Mengambil dari Jaringan dan meng-cache:",e.request.url),fetch(e.request).then((t=>{if(t.ok&&"basic"===t.type&&"GET"===e.request.method&&!e.request.url.startsWith("data:")){const n=t.clone();caches.open(CACHE_NAME).then((t=>{t.put(e.request,n)}))}return t}))))).catch((t=>(console.error("[Service Worker] Error di fetch handler:",e.request.url,t),new Response("<h1>Terjadi Kesalahan.</h1>",{headers:{"Content-Type":"text/html"},status:500}))))):e.respondWith(fetch(e.request).then((t=>{if(t.ok){const n=t.clone();caches.open(CACHE_NAME).then((t=>{t.put(e.request,n)}))}return t})).catch((()=>(console.log("[Service Worker] Jaringan gagal, mencoba dari cache untuk:",e.request.url),caches.match(e.request).then((e=>e||new Response("<h1>Anda sedang offline.</h1>",{headers:{"Content-Type":"text/html"}})))))))})),self.addEventListener("push",(e=>{console.log("Push event received:",e);let t={title:"New Notification",body:"You have a new message!",icon:"/icons/icon-192x192.png",badge:"/icons/icon-32x32.png",tag:"default-notification",data:{url:"/"}};if(e.data)try{const n=e.data.json();t={...t,...n}}catch(e){console.error("Error parsing push data:",e)}e.waitUntil(self.registration.showNotification(t.title,{body:t.body,icon:t.icon,badge:t.badge,tag:t.tag,data:t.data,actions:[{action:"open",title:"Open App",icon:"/icons/icon-32x32.png"},{action:"close",title:"Close"}],requireInteraction:!1,silent:!1}))})),self.addEventListener("notificationclick",(e=>{if(console.log("Notifikasi diklik:",e),e.notification.close(),"close"===e.action)return;const t=e.notification.data?.url||"/";e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((e=>{for(const n of e)if(n.url===t&&"focus"in n)return n.focus();if(clients.openWindow)return clients.openWindow(t)})))}));