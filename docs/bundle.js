/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t={452:t=>{var e=function(t){"use strict";var e,r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),s=new L(n||[]);return o(a,"_invoke",{value:O(t,r,s)}),a}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f="suspendedStart",p="suspendedYield",d="executing",v="completed",y={};function g(){}function m(){}function w(){}var b={};c(b,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(F([])));k&&k!==r&&n.call(k,a)&&(b=k);var E=w.prototype=g.prototype=Object.create(b);function S(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function r(o,i,a,s){var u=h(t[o],t,i);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(t,r,n){var o=f;return function(i,a){if(o===d)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=P(s,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var c=h(t,r,n);if("normal"===c.type){if(o=n.done?v:p,c.arg===y)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=v,n.method="throw",n.arg=c.arg)}}}function P(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,P(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=h(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function F(t){if(null!=t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(typeof t+" is not iterable")}return m.prototype=w,o(E,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:m,configurable:!0}),m.displayName=c(w,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,c(t,u,"GeneratorFunction")),t.prototype=Object.create(E),t},t.awrap=function(t){return{__await:t}},S(_.prototype),c(_.prototype,s,(function(){return this})),t.AsyncIterator=_,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new _(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(E),c(E,u,"Generator"),c(E,a,(function(){return this})),c(E,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=F,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:F(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}},900:(t,e,r)=>{"use strict";function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){a(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function a(t,e,r){return(e=function(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function s(){s=function(){return e};var t,e={},r=Object.prototype,o=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function l(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function h(e,r,n,o){var i=r&&r.prototype instanceof d?r:d,a=Object.create(i.prototype);return l(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=E(s,n);if(u){if(u===p)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=f(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new O(o||[])),!0),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var p={};function d(){}function v(){}function y(){}var g={};l(g,a,(function(){return this}));var m=Object.getPrototypeOf,w=m&&m(m(P([])));w&&w!==r&&o.call(w,a)&&(g=w);var b=y.prototype=d.prototype=Object.create(g);function x(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(i,a,s,u){var c=f(t[i],t,a);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==n(h)&&o.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,s,u)}),(function(t){r("throw",t,s,u)})):e.resolve(h).then((function(t){l.value=t,s(l)}),(function(t){return r("throw",t,s,u)}))}u(c.arg)}var i;l(this,"_invoke",(function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}),!0)}function E(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,E(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var i=f(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,p;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,p):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function S(t){this.tryEntries.push(t)}function _(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function O(t){this.tryEntries=[[-1]],t.forEach(S,this),this.reset(!0)}function P(e){if(null!=e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(o.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(n(e)+" is not iterable")}return v.prototype=y,l(b,"constructor",y),l(y,"constructor",v),v.displayName=l(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,l(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},e.awrap=function(t){return{__await:t}},x(k.prototype),l(k.prototype,u,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(b),l(b,c,"Generator"),l(b,a,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=P,O.prototype={constructor:O,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],p):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),_(r),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:P(e),r,n},"next"===this.method&&(this.arg=t),p}},e}function u(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function c(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){u(i,n,o,a,s,"next",t)}function s(t){u(i,n,o,a,s,"throw",t)}a(void 0)}))}}r.r(e),r.d(e,{default:()=>p});var l="https://story-api.dicoding.dev/v1",h=function(){var t=localStorage.getItem("token");return t?{Authorization:"Bearer ".concat(t)}:{}},f=function(t,e){var r,n,o;return 401===(null==e?void 0:e.status)||403===(null==e?void 0:e.status)||(null==t||null===(r=t.message)||void 0===r?void 0:r.toLowerCase().includes("token"))||(null==t||null===(n=t.message)||void 0===n?void 0:n.toLowerCase().includes("unauthorized"))||(null==t||null===(o=t.message)||void 0===o?void 0:o.toLowerCase().includes("forbidden"))};const p={register:function(t){return c(s().mark((function e(){var r,n,o,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.name,n=t.email,o=t.password,e.prev=1,e.next=4,fetch("".concat(l,"/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r,email:n,password:o})});case 4:return i=e.sent,e.next=7,i.json();case 7:if(a=e.sent,i.ok){e.next=10;break}throw new Error(a.message||"Registrasi gagal.");case 10:return e.abrupt("return",a);case 13:return e.prev=13,e.t0=e.catch(1),console.error("API Error - register:",e.t0),e.abrupt("return",{error:!0,message:e.t0.message||"Terjadi kesalahan saat registrasi."});case 17:case"end":return e.stop()}}),e,null,[[1,13]])})))()},login:function(t){return c(s().mark((function e(){var r,n,o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.email,n=t.password,e.prev=1,e.next=4,fetch("".concat(l,"/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r,password:n})});case 4:return o=e.sent,e.next=7,o.json();case 7:if(i=e.sent,o.ok){e.next=10;break}throw new Error(i.message||"Login gagal.");case 10:return e.abrupt("return",i);case 13:return e.prev=13,e.t0=e.catch(1),console.error("API Error - login:",e.t0),e.abrupt("return",{error:!0,message:e.t0.message||"Terjadi kesalahan saat login."});case 17:case"end":return e.stop()}}),e,null,[[1,13]])})))()},getAllStories:function(){var t=arguments;return c(s().mark((function e(){var r,n,o,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.length>0&&void 0!==t[0]?t[0]:1,n=t.length>1&&void 0!==t[1]?t[1]:10,o=t.length>2&&void 0!==t[2]?t[2]:0,e.prev=3,localStorage.getItem("token")){e.next=7;break}throw new Error("Authentication token not found. Please login.");case 7:return e.next=9,fetch("".concat(l,"/stories?page=").concat(r,"&size=").concat(n,"&location=").concat(o),{headers:h()});case 9:return i=e.sent,e.next=12,i.json();case 12:if(a=e.sent,i.ok){e.next=18;break}if(!f(a,i)){e.next=17;break}throw localStorage.removeItem("token"),new Error("Your session has expired. Please login again.");case 17:throw new Error(a.message||"Gagal mengambil daftar cerita.");case 18:return e.abrupt("return",a);case 21:return e.prev=21,e.t0=e.catch(3),console.error("API Error - getAllStories:",e.t0),(e.t0.message.includes("session has expired")||e.t0.message.includes("Authentication token not found"))&&localStorage.removeItem("token"),e.abrupt("return",{error:!0,message:e.t0.message||"Terjadi kesalahan saat mengambil cerita."});case 26:case"end":return e.stop()}}),e,null,[[3,21]])})))()},getStoryById:function(t){return c(s().mark((function e(){var r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,localStorage.getItem("token")){e.next=4;break}throw new Error("Authentication token not found. Please login.");case 4:return e.next=6,fetch("".concat(l,"/stories/").concat(t),{headers:h()});case 6:return r=e.sent,e.next=9,r.json();case 9:if(n=e.sent,r.ok){e.next=15;break}if(!f(n,r)){e.next=14;break}throw localStorage.removeItem("token"),new Error("Your session has expired. Please login again.");case 14:throw new Error(n.message||"Gagal mengambil detail cerita dengan ID ".concat(t,"."));case 15:return e.abrupt("return",n);case 18:return e.prev=18,e.t0=e.catch(0),console.error("API Error - getStoryById(".concat(t,"):"),e.t0),(e.t0.message.includes("session has expired")||e.t0.message.includes("Authentication token not found"))&&localStorage.removeItem("token"),e.abrupt("return",{error:!0,message:e.t0.message||"Terjadi kesalahan saat mengambil detail cerita dengan ID ".concat(t,".")});case 23:case"end":return e.stop()}}),e,null,[[0,18]])})))()},addStory:function(t){return c(s().mark((function e(){var r,n,o,i,a,u,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.description,n=t.photo,o=t.lat,i=t.lon,e.prev=1,localStorage.getItem("token")){e.next=5;break}throw new Error("Authentication token not found. Please login.");case 5:return(a=new FormData).append("description",r),a.append("photo",n),void 0!==o&&void 0!==i&&(a.append("lat",o),a.append("lon",i)),e.next=11,fetch("".concat(l,"/stories"),{method:"POST",headers:h(),body:a});case 11:return u=e.sent,e.next=14,u.json();case 14:if(c=e.sent,u.ok){e.next=20;break}if(!f(c,u)){e.next=19;break}throw localStorage.removeItem("token"),new Error("Your session has expired. Please login again.");case 19:throw new Error(c.message||"Gagal menambahkan cerita.");case 20:return e.abrupt("return",c);case 23:return e.prev=23,e.t0=e.catch(1),console.error("API Error - addStory:",e.t0),(e.t0.message.includes("session has expired")||e.t0.message.includes("Authentication token not found"))&&localStorage.removeItem("token"),e.abrupt("return",{error:!0,message:e.t0.message||"Terjadi kesalahan saat menambahkan cerita."});case 28:case"end":return e.stop()}}),e,null,[[1,23]])})))()},addStoryGuest:function(t){return c(s().mark((function e(){var r,n,o,i,a,u,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.description,n=t.photo,o=t.lat,i=t.lon,(a=new FormData).append("description",r),a.append("photo",n),void 0!==o&&void 0!==i&&(a.append("lat",o),a.append("lon",i)),e.prev=5,e.next=8,fetch("".concat(l,"/stories/guest"),{method:"POST",body:a});case 8:return u=e.sent,e.next=11,u.json();case 11:if(c=e.sent,u.ok){e.next=14;break}throw new Error(c.message||"Gagal menambahkan cerita tamu.");case 14:return e.abrupt("return",c);case 17:return e.prev=17,e.t0=e.catch(5),console.error("API Error - addStoryGuest:",e.t0),e.abrupt("return",{error:!0,message:e.t0.message||"Terjadi kesalahan saat menambahkan cerita tamu."});case 21:case"end":return e.stop()}}),e,null,[[5,17]])})))()},subscribePushNotification:function(t){return c(s().mark((function e(){var r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,localStorage.getItem("token")){e.next=4;break}throw new Error("Authentication token not found. Please login.");case 4:return e.next=6,fetch("".concat(l,"/notifications/subscribe"),{method:"POST",headers:i({"Content-Type":"application/json"},h()),body:JSON.stringify(t)});case 6:return r=e.sent,e.next=9,r.json();case 9:if(n=e.sent,r.ok){e.next=15;break}if(!f(n,r)){e.next=14;break}throw localStorage.removeItem("token"),new Error("Your session has expired. Please login again.");case 14:throw new Error(n.message||"Gagal mendaftar push notification.");case 15:return e.abrupt("return",n);case 18:return e.prev=18,e.t0=e.catch(0),console.error("API Error - subscribePushNotification:",e.t0),e.abrupt("return",{error:!0,message:e.t0.message||"Terjadi kesalahan saat mendaftar push notification."});case 22:case"end":return e.stop()}}),e,null,[[0,18]])})))()},unsubscribePushNotification:function(t){return c(s().mark((function e(){var r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,localStorage.getItem("token")){e.next=4;break}throw new Error("Authentication token not found. Please login.");case 4:return e.next=6,fetch("".concat(l,"/notifications/subscribe"),{method:"DELETE",headers:i({"Content-Type":"application/json"},h()),body:JSON.stringify({endpoint:t})});case 6:return r=e.sent,e.next=9,r.json();case 9:if(n=e.sent,r.ok){e.next=15;break}if(!f(n,r)){e.next=14;break}throw localStorage.removeItem("token"),new Error("Your session has expired. Please login again.");case 14:throw new Error(n.message||"Gagal berhenti mendaftar push notification.");case 15:return e.abrupt("return",n);case 18:return e.prev=18,e.t0=e.catch(0),console.error("API Error - unsubscribePushNotification:",e.t0),e.abrupt("return",{error:!0,message:e.t0.message||"Terjadi kesalahan saat berhenti mendaftar push notification."});case 22:case"end":return e.stop()}}),e,null,[[0,18]])})))()},sendTestNotification:function(t){return c(s().mark((function e(){var r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,localStorage.getItem("token")){e.next=4;break}throw new Error("Authentication token not found. Please login.");case 4:return e.next=6,fetch("".concat(l,"/notifications/test"),{method:"POST",headers:i({"Content-Type":"application/json"},h()),body:JSON.stringify(t)});case 6:return r=e.sent,e.next=9,r.json();case 9:if(n=e.sent,r.ok){e.next=15;break}if(!f(n,r)){e.next=14;break}throw localStorage.removeItem("token"),new Error("Your session has expired. Please login again.");case 14:throw new Error(n.message||"Gagal mengirim notifikasi tes.");case 15:return e.abrupt("return",n);case 18:return e.prev=18,e.t0=e.catch(0),console.error("API Error - sendTestNotification:",e.t0),e.abrupt("return",{error:!0,message:e.t0.message||"Terjadi kesalahan saat mengirim notifikasi tes."});case 22:case"end":return e.stop()}}),e,null,[[0,18]])})))()}}}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";const t={parseActiveUrlWithCombiner:function(){var t=window.location.hash.slice(1),e=this._urlSplitter(t);return this._combineUrl(e)},parseActiveUrlWithoutCombiner:function(){var t=window.location.hash.slice(1);return this._urlSplitter(t)},_urlSplitter:function(t){var e=t.split("/");return{resource:e[1]||null,id:e[2]||null,verb:e[3]||null}},_combineUrl:function(t){var e=t.resource,r=t.id,n=t.verb,o="/".concat(e);return r&&(o+="/:id"),n&&(o+="/".concat(n)),o}};function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(){n=function(){return r};var t,r={},o=Object.prototype,i=o.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function l(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function h(e,r,n,o){var i=r&&r.prototype instanceof d?r:d,a=Object.create(i.prototype);return l(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=E(s,n);if(u){if(u===p)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=f(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new O(o||[])),!0),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}r.wrap=h;var p={};function d(){}function v(){}function y(){}var g={};l(g,s,(function(){return this}));var m=Object.getPrototypeOf,w=m&&m(m(P([])));w&&w!==o&&i.call(w,s)&&(g=w);var b=y.prototype=d.prototype=Object.create(g);function x(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,r){function n(o,a,s,u){var c=f(t[o],t,a);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==e(h)&&i.call(h,"__await")?r.resolve(h.__await).then((function(t){n("next",t,s,u)}),(function(t){n("throw",t,s,u)})):r.resolve(h).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,u)}))}u(c.arg)}var o;l(this,"_invoke",(function(t,e){function i(){return new r((function(r,o){n(t,e,r,o)}))}return o=o?o.then(i,i):i()}),!0)}function E(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,E(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var i=f(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,p;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,p):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function S(t){this.tryEntries.push(t)}function _(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function O(t){this.tryEntries=[[-1]],t.forEach(S,this),this.reset(!0)}function P(r){if(null!=r){var n=r[s];if(n)return n.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var o=-1,a=function e(){for(;++o<r.length;)if(i.call(r,o))return e.value=r[o],e.done=!1,e;return e.value=t,e.done=!0,e};return a.next=a}}throw new TypeError(e(r)+" is not iterable")}return v.prototype=y,l(b,"constructor",y),l(y,"constructor",v),v.displayName=l(y,c,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,l(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},r.awrap=function(t){return{__await:t}},x(k.prototype),l(k.prototype,u,(function(){return this})),r.AsyncIterator=k,r.async=function(t,e,n,o,i){void 0===i&&(i=Promise);var a=new k(h(t,e,n,o),i);return r.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(b),l(b,c,"Generator"),l(b,s,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},r.values=P,O.prototype={constructor:O,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],p):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),_(r),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:P(e),r,n},"next"===this.method&&(this.arg=t),p}},r}function o(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function s(t){o(a,n,i,s,u,"next",t)}function u(t){o(a,n,i,s,u,"throw",t)}s(void 0)}))}}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,s(n.key),n)}}function s(t){var r=function(t){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:r+""}const u=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.view=e,this.model=r},e=[{key:"init",value:(o=i(n().mark((function t(){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.model.isAuthenticated();case 2:if(t.sent){t.next=6;break}return this.view.renderAuthenticationRequired(),t.abrupt("return");case 6:return this.view.initializeMap(),t.next=9,this.loadStories();case 9:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"loadStories",value:(r=i(n().mark((function t(){var e;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.view.showLoading(),t.next=4,this.model.getStories();case 4:e=t.sent,this.view.renderStories(e),this.view.addStoriesToMap(e),t.next=17;break;case 9:if(t.prev=9,t.t0=t.catch(0),console.error("Error loading stories:",t.t0),!("Authentication required"===t.t0.message||"Session expired"===t.t0.message||t.t0.message.includes("token")||t.t0.message.includes("unauthorized")||t.t0.message.includes("session has expired"))){t.next=16;break}return this.model.logout(),this.view.showError("Your session has expired. Please login again."),t.abrupt("return");case 16:this.view.showError("Failed to load stories. ".concat(t.t0.message));case 17:case"end":return t.stop()}}),t,this,[[0,9]])}))),function(){return r.apply(this,arguments)})},{key:"onStoryClick",value:function(t){this.view.navigateToStoryDetail(t)}},{key:"truncateText",value:function(t,e){return!t||t.length<=e?t:t.substring(0,e)+"..."}},{key:"formatDate",value:function(t){var e=new Date(t),r=new Date,n=e.getDate()===r.getDate()&&e.getMonth()===r.getMonth()&&e.getFullYear()===r.getFullYear(),o=new Date;o.setDate(r.getDate()-1);var i=e.getDate()===o.getDate()&&e.getMonth()===o.getMonth()&&e.getFullYear()===o.getFullYear();return n?"Today":i?"Yesterday":e.toLocaleDateString(void 0,{day:"numeric",month:"short",year:"numeric"})}}],e&&a(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,o}();var c=r(900),l="token";const h={saveToken:function(t){"string"==typeof t?localStorage.setItem(l,t):console.warn("AuthService: Token harus berupa string.")},getToken:function(){return localStorage.getItem(l)},removeToken:function(){localStorage.removeItem(l)},isLoggedIn:function(){return!!this.getToken()},logout:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.removeToken(),t&&(window.location.hash="#/login")},requireAuth:function(){return!!this.isLoggedIn()||(this.logout(!0),!1)}};function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function p(){p=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof d?r:d,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=E(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new O(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function d(){}function v(){}function y(){}var g={};u(g,i,(function(){return this}));var m=Object.getPrototypeOf,w=m&&m(m(P([])));w&&w!==r&&n.call(w,i)&&(g=w);var b=y.prototype=d.prototype=Object.create(g);function x(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==f(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function E(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,E(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function S(t){this.tryEntries.push(t)}function _(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function O(t){this.tryEntries=[[-1]],t.forEach(S,this),this.reset(!0)}function P(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(f(e)+" is not iterable")}return v.prototype=y,u(b,"constructor",y),u(y,"constructor",v),v.displayName=u(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,s,"GeneratorFunction")),t.prototype=Object.create(b),t},e.awrap=function(t){return{__await:t}},x(k.prototype),u(k.prototype,a,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(b),u(b,s,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=P,O.prototype={constructor:O,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),_(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:P(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function d(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function v(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,y(n.key),n)}}function y(t){var e=function(t){if("object"!=f(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=f(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==f(e)?e:e+""}const g=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.stories=[]},e=[{key:"getStories",value:(r=p().mark((function t(){var e;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,h.isLoggedIn()){t.next=3;break}throw new Error("Authentication required");case 3:return t.next=5,c.default.getAllStories(1,20,1);case 5:if(!(e=t.sent).error){t.next=11;break}if(!e.message||!(e.message.includes("token")||e.message.includes("unauthorized")||e.message.includes("session has expired"))){t.next=10;break}throw h.logout(),new Error("Session expired");case 10:throw new Error(e.message);case 11:return this.stories=e.listStory||[],t.abrupt("return",this.stories);case 15:throw t.prev=15,t.t0=t.catch(0),console.error("Error in HomeModel.getStories:",t.t0),t.t0;case 19:case"end":return t.stop()}}),t,this,[[0,15]])})),n=function(){var t=this,e=arguments;return new Promise((function(n,o){var i=r.apply(t,e);function a(t){d(i,n,o,a,s,"next",t)}function s(t){d(i,n,o,a,s,"throw",t)}a(void 0)}))},function(){return n.apply(this,arguments)})},{key:"isAuthenticated",value:function(){return h.isLoggedIn()}},{key:"logout",value:function(){h.logout()}},{key:"getStoriesWithValidCoordinates",value:function(){return this.stories.filter((function(t){if(!t.lat||!t.lon)return!1;var e=parseFloat(t.lat),r=parseFloat(t.lon);return!isNaN(e)&&!isNaN(r)&&e>=-90&&e<=90&&r>=-180&&r<=180}))}}],e&&v(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function w(){w=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=E(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new O(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(P([])));g&&g!==r&&n.call(g,i)&&(v=g);var b=d.prototype=f.prototype=Object.create(v);function x(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==m(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function E(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,E(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function S(t){this.tryEntries.push(t)}function _(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function O(t){this.tryEntries=[[-1]],t.forEach(S,this),this.reset(!0)}function P(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(m(e)+" is not iterable")}return p.prototype=d,u(b,"constructor",d),u(d,"constructor",p),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,s,"GeneratorFunction")),t.prototype=Object.create(b),t},e.awrap=function(t){return{__await:t}},x(k.prototype),u(k.prototype,a,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(b),u(b,s,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=P,O.prototype={constructor:O,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),_(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:P(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function b(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function x(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){b(i,n,o,a,s,"next",t)}function s(t){b(i,n,o,a,s,"throw",t)}a(void 0)}))}}const k={VAPID_PUBLIC_KEY:"BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk",_formatSubscriptionData:function(t){try{var e=t.toJSON();if(!e.keys||!e.keys.p256dh||!e.keys.auth)throw new Error("Subscription keys tidak lengkap");return{endpoint:e.endpoint,keys:{p256dh:e.keys.p256dh,auth:e.keys.auth}}}catch(t){throw console.error("Error formatting subscription data:",t),t}},requestPermission:function(){return x(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("Notification"in window){t.next=3;break}return console.warn("Browser ini tidak mendukung notifikasi."),t.abrupt("return",!1);case 3:return t.next=5,Notification.requestPermission();case 5:if("granted"!==t.sent){t.next=11;break}return console.log("Izin notifikasi diberikan."),t.abrupt("return",!0);case 11:return console.warn("Izin notifikasi ditolak atau diabaikan."),t.abrupt("return",!1);case 13:case"end":return t.stop()}}),t)})))()},registerServiceWorker:function(){return x(w().mark((function t(){var e;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("serviceWorker"in navigator)){t.next=17;break}return t.prev=1,t.next=4,navigator.serviceWorker.register("/service-worker.js");case 4:return e=t.sent,console.log("Service Worker terdaftar dengan scope:",e.scope),t.next=8,navigator.serviceWorker.ready;case 8:return t.abrupt("return",e);case 11:return t.prev=11,t.t0=t.catch(1),console.error("Pendaftaran Service Worker gagal:",t.t0),t.abrupt("return",null);case 15:t.next=19;break;case 17:return console.warn("Service Workers tidak didukung di browser ini."),t.abrupt("return",null);case 19:case"end":return t.stop()}}),t,null,[[1,11]])})))()},getSubscriptionStatus:function(){return x(w().mark((function t(){var e,r;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("serviceWorker"in navigator&&"PushManager"in window){t.next=2;break}return t.abrupt("return","unsupported");case 2:return t.prev=2,t.next=5,navigator.serviceWorker.ready;case 5:return e=t.sent,t.next=8,e.pushManager.getSubscription();case 8:if(!t.sent){t.next=13;break}return t.abrupt("return","subscribed");case 13:return r=Notification.permission,t.abrupt("return","granted"===r?"granted-no-subscription":r);case 15:t.next=21;break;case 17:return t.prev=17,t.t0=t.catch(2),console.error("Gagal mendapatkan status langganan:",t.t0),t.abrupt("return","error");case 21:case"end":return t.stop()}}),t,null,[[2,17]])})))()},subscribeUser:function(){var t=this;return x(w().mark((function e(){var r,n,o,i,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("serviceWorker"in navigator&&"PushManager"in window){e.next=3;break}return console.warn("Push messaging tidak didukung."),e.abrupt("return",!1);case 3:return e.prev=3,e.next=6,t.requestPermission();case 6:if(e.sent){e.next=10;break}return console.log("Permission ditolak"),e.abrupt("return",!1);case 10:return e.next=12,navigator.serviceWorker.ready;case 12:if(r=e.sent){e.next=16;break}return console.error("Service Worker tidak siap"),e.abrupt("return",!1);case 16:return e.next=18,r.pushManager.getSubscription();case 18:if(n=e.sent){e.next=25;break}return console.log("Membuat subscription baru..."),o=t._urlB64ToUint8Array(t.VAPID_PUBLIC_KEY),e.next=24,r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:o});case 24:n=e.sent;case 25:return i=t._formatSubscriptionData(n),console.log("Sending subscription to server:",i),e.next=29,c.default.subscribePushNotification(i);case 29:if((a=e.sent).error){e.next=35;break}return console.log("Subscription berhasil dikirim ke server"),e.abrupt("return",!0);case 35:return console.error("Gagal mengirim subscription:",a.message),e.abrupt("return",!1);case 37:e.next=43;break;case 39:return e.prev=39,e.t0=e.catch(3),console.error("Error dalam subscribeUser:",e.t0),e.abrupt("return",!1);case 43:case"end":return e.stop()}}),e,null,[[3,39]])})))()},unsubscribeUser:function(){return x(w().mark((function t(){var e,r,n,o;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("serviceWorker"in navigator&&"PushManager"in window){t.next=3;break}return console.warn("Push messaging tidak didukung."),t.abrupt("return",!1);case 3:return t.next=5,navigator.serviceWorker.ready;case 5:if(e=t.sent){t.next=9;break}return console.error("Service Worker tidak siap."),t.abrupt("return",!1);case 9:return t.prev=9,t.next=12,e.pushManager.getSubscription();case 12:if(!(r=t.sent)){t.next=29;break}return n=r.endpoint,t.next=17,c.default.unsubscribePushNotification(n);case 17:if((o=t.sent).error){t.next=25;break}return t.next=21,r.unsubscribe();case 21:return console.log("Berhasil berhenti berlangganan notifikasi push."),t.abrupt("return",!0);case 25:return console.error("Gagal berhenti berlangganan dari server:",o.message),t.abrupt("return",!1);case 27:t.next=31;break;case 29:return console.log("Tidak ada langganan aktif."),t.abrupt("return",!0);case 31:t.next=37;break;case 33:return t.prev=33,t.t0=t.catch(9),console.error("Gagal berhenti berlangganan:",t.t0),t.abrupt("return",!1);case 37:case"end":return t.stop()}}),t,null,[[9,33]])})))()},sendTestNotification:function(){var t=this;return x(w().mark((function e(){var r,n,o,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("serviceWorker"in navigator&&"PushManager"in window){e.next=3;break}return console.warn("Push messaging tidak didukung."),e.abrupt("return",!1);case 3:return e.next=5,navigator.serviceWorker.ready;case 5:if(r=e.sent){e.next=9;break}return console.error("Service Worker tidak siap."),e.abrupt("return",!1);case 9:return e.prev=9,e.next=12,r.pushManager.getSubscription();case 12:if(!(n=e.sent)){e.next=27;break}return o=t._formatSubscriptionData(n),e.next=17,c.default.sendTestNotification(o);case 17:if((i=e.sent).error){e.next=23;break}return console.log("Notifikasi tes berhasil dikirim."),e.abrupt("return",!0);case 23:return console.error("Gagal mengirim notifikasi tes:",i.message),e.abrupt("return",!1);case 25:e.next=29;break;case 27:return console.warn("Tidak ada langganan push aktif."),e.abrupt("return",!1);case 29:e.next=35;break;case 31:return e.prev=31,e.t0=e.catch(9),console.error("Tidak dapat mengirim notifikasi tes:",e.t0),e.abrupt("return",!1);case 35:case"end":return e.stop()}}),e,null,[[9,31]])})))()},_urlB64ToUint8Array:function(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),r=atob(e),n=new Uint8Array(r.length),o=0;o<r.length;++o)n[o]=r.charCodeAt(o);return n}},E=(t,e)=>e.some((e=>t instanceof e));let S,_;const O=new WeakMap,P=new WeakMap,j=new WeakMap;let T={get(t,e,r){if(t instanceof IDBTransaction){if("done"===e)return O.get(t);if("store"===e)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return N(t[e])},set:(t,e,r)=>(t[e]=r,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function F(t){T=t(T)}function A(t){return"function"==typeof t?(e=t,(_||(_=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(I(this),t),N(this.request)}:function(...t){return N(e.apply(I(this),t))}):(t instanceof IDBTransaction&&function(t){if(O.has(t))return;const e=new Promise(((e,r)=>{const n=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",i),t.removeEventListener("abort",i)},o=()=>{e(),n()},i=()=>{r(t.error||new DOMException("AbortError","AbortError")),n()};t.addEventListener("complete",o),t.addEventListener("error",i),t.addEventListener("abort",i)}));O.set(t,e)}(t),E(t,S||(S=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,T):t);var e}function N(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,r)=>{const n=()=>{t.removeEventListener("success",o),t.removeEventListener("error",i)},o=()=>{e(N(t.result)),n()},i=()=>{r(t.error),n()};t.addEventListener("success",o),t.addEventListener("error",i)}));return j.set(e,t),e}(t);if(P.has(t))return P.get(t);const e=A(t);return e!==t&&(P.set(t,e),j.set(e,t)),e}const I=t=>j.get(t);function G(t,e,{blocked:r,upgrade:n,blocking:o,terminated:i}={}){const a=indexedDB.open(t,e),s=N(a);return n&&a.addEventListener("upgradeneeded",(t=>{n(N(a.result),t.oldVersion,t.newVersion,N(a.transaction),t)})),r&&a.addEventListener("blocked",(t=>r(t.oldVersion,t.newVersion,t))),s.then((t=>{i&&t.addEventListener("close",(()=>i())),o&&t.addEventListener("versionchange",(t=>o(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),s}const D=["get","getKey","getAll","getAllKeys","count"],C=["put","add","delete","clear"],q=new Map;function M(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(q.get(e))return q.get(e);const r=e.replace(/FromIndex$/,""),n=e!==r,o=C.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!o&&!D.includes(r))return;const i=async function(t,...e){const i=this.transaction(t,o?"readwrite":"readonly");let a=i.store;return n&&(a=a.index(e.shift())),(await Promise.all([a[r](...e),o&&i.done]))[0]};return q.set(e,i),i}F((t=>({...t,get:(e,r,n)=>M(e,r)||t.get(e,r,n),has:(e,r)=>!!M(e,r)||t.has(e,r)})));const B=["continue","continuePrimaryKey","advance"],V={},R=new WeakMap,U=new WeakMap,H={get(t,e){if(!B.includes(e))return t[e];let r=V[e];return r||(r=V[e]=function(...t){R.set(this,U.get(this)[e](...t))}),r}};async function*Y(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;const r=new Proxy(e,H);for(U.set(r,e),j.set(r,I(e));e;)yield r,e=await(R.get(r)||e.continue()),R.delete(r)}function z(t,e){return e===Symbol.asyncIterator&&E(t,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===e&&E(t,[IDBIndex,IDBObjectStore])}function W(t){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W(t)}function J(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Q(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?J(Object(r),!0).forEach((function(e){K(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function K(t,e,r){return(e=function(t){var e=function(t){if("object"!=W(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=W(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==W(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function $(){$=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=x(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new S(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==r&&n.call(g,i)&&(v=g);var m=d.prototype=f.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==W(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function x(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function k(t){this.tryEntries.push(t)}function E(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(W(e)+" is not iterable")}return p.prototype=d,u(m,"constructor",d),u(d,"constructor",p),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),u(m,s,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),E(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;E(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function X(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function Z(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){X(i,n,o,a,s,"next",t)}function s(t){X(i,n,o,a,s,"throw",t)}a(void 0)}))}}F((t=>({...t,get:(e,r,n)=>z(e,r)?Y:t.get(e,r,n),has:(e,r)=>z(e,r)||t.has(e,r)})));var tt="favorite-stories",et=function(){var t=Z($().mark((function t(){return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",G("story-db",1,{upgrade:function(t){if(!t.objectStoreNames.contains(tt)){var e=t.createObjectStore(tt,{keyPath:"id"});e.createIndex("name","name",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1})}}}));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();const rt={addFavoriteStory:function(t){return Z($().mark((function e(){var r,n,o,i;return $().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,et();case 3:return r=e.sent,n=r.transaction(tt,"readwrite"),o=n.objectStore(tt),i=Q(Q({},t),{},{favoritedAt:(new Date).toISOString(),isFavorite:!0}),e.next=9,o.put(i);case 9:return e.next=11,n.done;case 11:return console.log("Story added to favorites:",t.id),e.abrupt("return",!0);case 15:return e.prev=15,e.t0=e.catch(0),console.error("Error adding story to favorites:",e.t0),e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e,null,[[0,15]])})))()},removeFavoriteStory:function(t){return Z($().mark((function e(){var r,n,o;return $().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,et();case 3:return r=e.sent,n=r.transaction(tt,"readwrite"),o=n.objectStore(tt),e.next=8,o.delete(t);case 8:return e.next=10,n.done;case 10:return console.log("Story removed from favorites:",t),e.abrupt("return",!0);case 14:return e.prev=14,e.t0=e.catch(0),console.error("Error removing story from favorites:",e.t0),e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e,null,[[0,14]])})))()},getAllFavoriteStories:function(){return Z($().mark((function t(){var e,r;return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,et();case 3:return e=t.sent,t.next=6,e.getAll(tt);case 6:return r=t.sent,t.abrupt("return",r.sort((function(t,e){return new Date(e.favoritedAt)-new Date(t.favoritedAt)})));case 10:return t.prev=10,t.t0=t.catch(0),console.error("Error getting favorite stories:",t.t0),t.abrupt("return",[]);case 14:case"end":return t.stop()}}),t,null,[[0,10]])})))()},getFavoriteStory:function(t){return Z($().mark((function e(){var r;return $().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,et();case 3:return r=e.sent,e.next=6,r.get(tt,t);case 6:return e.abrupt("return",e.sent);case 9:return e.prev=9,e.t0=e.catch(0),console.error("Error getting favorite story:",e.t0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))()},isFavoriteStory:function(t){var e=this;return Z($().mark((function r(){var n;return $().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.getFavoriteStory(t);case 3:return n=r.sent,r.abrupt("return",void 0!==n);case 7:return r.prev=7,r.t0=r.catch(0),console.error("Error checking if story is favorite:",r.t0),r.abrupt("return",!1);case 11:case"end":return r.stop()}}),r,null,[[0,7]])})))()},clearAllFavorites:function(){return Z($().mark((function t(){var e,r;return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,et();case 3:return e=t.sent,r=e.transaction(tt,"readwrite"),t.next=7,r.objectStore(tt).clear();case 7:return t.next=9,r.done;case 9:return console.log("All favorite stories cleared"),t.abrupt("return",!0);case 13:return t.prev=13,t.t0=t.catch(0),console.error("Error clearing favorite stories:",t.t0),t.abrupt("return",!1);case 17:case"end":return t.stop()}}),t,null,[[0,13]])})))()},getFavoriteCount:function(){return Z($().mark((function t(){var e;return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,et();case 3:return e=t.sent,t.next=6,e.count(tt);case 6:return t.abrupt("return",t.sent);case 9:return t.prev=9,t.t0=t.catch(0),console.error("Error getting favorite count:",t.t0),t.abrupt("return",0);case 13:case"end":return t.stop()}}),t,null,[[0,9]])})))()},saveStories:function(){return Z($().mark((function t(){return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.warn("saveStories is deprecated. Use favorite story methods instead.");case 2:case"end":return t.stop()}}),t)})))()},getAllStories:function(){var t=this;return Z($().mark((function e(){return $().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.warn("getAllStories is deprecated. Use getAllFavoriteStories instead."),e.abrupt("return",t.getAllFavoriteStories());case 2:case"end":return e.stop()}}),e)})))()},deleteAllStories:function(){var t=this;return Z($().mark((function e(){return $().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.warn("deleteAllStories is deprecated. Use clearAllFavorites instead."),e.abrupt("return",t.clearAllFavorites());case 2:case"end":return e.stop()}}),e)})))()}};function nt(t){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nt(t)}function ot(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function it(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ot(Object(r),!0).forEach((function(e){at(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ot(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function at(t,e,r){return(e=function(t){var e=function(t){if("object"!=nt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=nt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==nt(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function st(){st=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=x(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new S(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==r&&n.call(g,i)&&(v=g);var m=d.prototype=f.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==nt(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function x(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function k(t){this.tryEntries.push(t)}function E(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(nt(e)+" is not iterable")}return p.prototype=d,u(m,"constructor",d),u(d,"constructor",p),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),u(m,s,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),E(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;E(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function ut(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function ct(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ut(i,n,o,a,s,"next",t)}function s(t){ut(i,n,o,a,s,"throw",t)}a(void 0)}))}}const lt={presenter:null,model:null,map:null,notificationStatus:"default",currentView:"latest",currentStories:[],render:function(){return ct(st().mark((function t(){return st().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n      <div class="story-section">\n        <div class="section-header">\n          <h2 class="section-title">\n            <i class="fas fa-star" aria-hidden="true" style="color: #ffee00;"></i> \n            <span id="section-title-text">Latest Stories</span>\n          </h2>\n          <p class="section-subtitle">\n            <span id="section-subtitle-text">Discover amazing stories from around the world</span>\n          </p>\n          \n          \x3c!-- View Toggle Buttons --\x3e\n          <div class="view-toggle">\n            <button id="latest-view-btn" class="btn btn-primary active">\n              <i class="fas fa-newspaper" aria-hidden="true"></i> Latest Stories\n            </button>\n            <button id="favorites-view-btn" class="btn btn-secondary">\n              <i class="fas fa-heart" aria-hidden="true"></i> My Favorites (<span id="favorites-count">0</span>)\n            </button>\n            <button id="clear-favorites-btn" class="btn btn-danger" style="display: none;">\n              <i class="fas fa-trash" aria-hidden="true"></i> Clear All Favorites\n            </button>\n          </div>\n\n          <div class="notification-actions">\n            <button id="subscribe-push-button" class="btn" style="display: none;">\n              <i class="fas fa-bell" aria-hidden="true"></i> Enable Notifications\n            </button>\n            <button id="unsubscribe-push-button" class="btn btn-secondary" style="display: none;">\n              <i class="fas fa-bell-slash" aria-hidden="true"></i> Disable Notifications\n            </button>\n          </div>\n        </div>\n        \n        <div id="story-list" class="story-list" role="main" aria-label="List of stories">\n          <div class="loading">\n            <div class="spinner" aria-hidden="true"></div>\n            <span>Loading stories...</span>\n          </div>\n        </div>\n      </div>\n\n      <div class="map-container">\n        <div class="map-header">\n          <h3 class="map-title">\n            <i class="fas fa-globe-asia" aria-hidden="true"></i> Story Locations\n          </h3>\n          <p class="map-subtitle">\n            Explore where these amazing stories took place\n          </p>\n        </div>\n        <div id="map" aria-label="Map showing story locations"></div>\n      </div>\n    ');case 1:case"end":return t.stop()}}),t)})))()},afterRender:function(){var t=this;return ct(st().mark((function e(){return st().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.model=new g,t.presenter=new u(t,t.model),e.next=4,t.initViewToggle();case 4:return e.next=6,t.initNotificationButtons();case 6:return e.next=8,t.updateFavoritesCount();case 8:return e.next=10,t.presenter.init();case 10:case"end":return e.stop()}}),e)})))()},initViewToggle:function(){var t=this;return ct(st().mark((function e(){var r,n,o;return st().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=document.getElementById("latest-view-btn"),n=document.getElementById("favorites-view-btn"),o=document.getElementById("clear-favorites-btn"),r&&r.addEventListener("click",ct(st().mark((function e(){return st().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.switchToLatestView();case 2:case"end":return e.stop()}}),e)})))),n&&n.addEventListener("click",ct(st().mark((function e(){return st().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.switchToFavoritesView();case 2:case"end":return e.stop()}}),e)})))),o&&o.addEventListener("click",ct(st().mark((function e(){return st().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.clearAllFavorites();case 2:case"end":return e.stop()}}),e)}))));case 6:case"end":return e.stop()}}),e)})))()},switchToLatestView:function(){var t=this;return ct(st().mark((function e(){return st().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.currentView="latest",t.updateViewButtons(),t.updateSectionHeader("Latest Stories","Discover amazing stories from around the world"),t.showLoading(),e.next=6,t.presenter.init();case 6:case"end":return e.stop()}}),e)})))()},switchToFavoritesView:function(){var t=this;return ct(st().mark((function e(){var r;return st().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.currentView="favorites",t.updateViewButtons(),t.updateSectionHeader("My Favorite Stories","Stories you've saved to read later"),t.showLoading(),e.next=6,rt.getAllFavoriteStories();case 6:r=e.sent,t.currentStories=r,t.renderStories(r),t.addStoriesToMap(r);case 10:case"end":return e.stop()}}),e)})))()},updateViewButtons:function(){var t=document.getElementById("latest-view-btn"),e=document.getElementById("favorites-view-btn"),r=document.getElementById("clear-favorites-btn");t&&e&&("latest"===this.currentView?(t.classList.add("active","btn-primary"),t.classList.remove("btn-secondary"),e.classList.remove("active","btn-primary"),e.classList.add("btn-secondary")):(e.classList.add("active","btn-primary"),e.classList.remove("btn-secondary"),t.classList.remove("active","btn-primary"),t.classList.add("btn-secondary"))),r&&(r.style.display="favorites"===this.currentView?"inline-block":"none")},updateSectionHeader:function(t,e){var r=document.getElementById("section-title-text"),n=document.getElementById("section-subtitle-text");r&&(r.textContent=t),n&&(n.textContent=e)},updateFavoritesCount:function(){return ct(st().mark((function t(){var e,r;return st().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,rt.getFavoriteCount();case 2:e=t.sent,(r=document.getElementById("favorites-count"))&&(r.textContent=e);case 5:case"end":return t.stop()}}),t)})))()},clearAllFavorites:function(){var t=this;return ct(st().mark((function e(){return st().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm("Are you sure you want to remove all favorite stories? This action cannot be undone.")){e.next=14;break}return e.next=3,rt.clearAllFavorites();case 3:if(!e.sent){e.next=13;break}return e.next=7,t.updateFavoritesCount();case 7:if("favorites"!==t.currentView){e.next=10;break}return e.next=10,t.switchToFavoritesView();case 10:t.showTemporaryMessage("All favorite stories have been removed.","success"),e.next=14;break;case 13:t.showTemporaryMessage("Failed to clear favorites. Please try again.","error");case 14:case"end":return e.stop()}}),e)})))()},toggleFavorite:function(t){var e=this;return ct(st().mark((function r(){var n;return st().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.currentStories.find((function(e){return e.id===t}))){r.next=3;break}return r.abrupt("return");case 3:return r.next=5,rt.isFavoriteStory(t);case 5:if(!r.sent){r.next=22;break}return r.next=9,rt.removeFavoriteStory(t);case 9:if(!r.sent){r.next=20;break}return e.showTemporaryMessage("Story removed from favorites","success"),r.next=14,e.updateFavoritesCount();case 14:if("favorites"!==e.currentView){r.next=19;break}return r.next=17,e.switchToFavoritesView();case 17:r.next=20;break;case 19:e.updateFavoriteIcon(t,!1);case 20:r.next=30;break;case 22:return r.next=24,rt.addFavoriteStory(n);case 24:if(!r.sent){r.next=30;break}return e.showTemporaryMessage("Story added to favorites","success"),r.next=29,e.updateFavoritesCount();case 29:e.updateFavoriteIcon(t,!0);case 30:case"end":return r.stop()}}),r)})))()},updateFavoriteIcon:function(t,e){var r=document.querySelector('[data-story-id="'.concat(t,'"] .favorite-btn'));if(r){var n=r.querySelector("i");n&&(e?(n.classList.remove("far"),n.classList.add("fas"),r.style.color="#e74c3c"):(n.classList.remove("fas"),n.classList.add("far"),r.style.color="#666"))}},showTemporaryMessage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=document.createElement("div");r.className="temporary-message ".concat(e),r.innerHTML='\n      <i class="fas '.concat("success"===e?"fa-check-circle":"error"===e?"fa-exclamation-circle":"fa-info-circle",'" aria-hidden="true"></i>\n      ').concat(t,"\n    "),r.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: ".concat("success"===e?"#d4edda":"error"===e?"#f8d7da":"#d1ecf1",";\n      color: ").concat("success"===e?"#155724":"error"===e?"#721c24":"#0c5460",";\n      border: 1px solid ").concat("success"===e?"#c3e6cb":"error"===e?"#f5c6cb":"#bee5eb",";\n      padding: 12px 16px;\n      border-radius: 4px;\n      z-index: 1000;\n      box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n      max-width: 300px;\n    "),document.body.appendChild(r),setTimeout((function(){r.parentNode&&r.parentNode.removeChild(r)}),3e3)},initNotificationButtons:function(){var t=this;return ct(st().mark((function e(){var r,n;return st().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.getSubscriptionStatus();case 2:t.notificationStatus=e.sent,t.updateNotificationButtonVisibility(),r=document.getElementById("subscribe-push-button"),n=document.getElementById("unsubscribe-push-button"),r&&r.addEventListener("click",ct(st().mark((function e(){return st().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.subscribeUser();case 2:e.sent&&(t.notificationStatus="subscribed",t.updateNotificationButtonVisibility());case 4:case"end":return e.stop()}}),e)})))),n&&n.addEventListener("click",ct(st().mark((function e(){return st().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.unsubscribeUser();case 2:e.sent&&(t.notificationStatus="default",t.updateNotificationButtonVisibility());case 4:case"end":return e.stop()}}),e)}))));case 8:case"end":return e.stop()}}),e)})))()},updateNotificationButtonVisibility:function(){var t=document.getElementById("subscribe-push-button"),e=document.getElementById("unsubscribe-push-button");t&&(t.style.display="none"),e&&(e.style.display="none"),"default"===this.notificationStatus||"granted-no-subscription"===this.notificationStatus?t&&(t.style.display="inline-block"):"subscribed"===this.notificationStatus?e&&(e.style.display="inline-block"):"denied"===this.notificationStatus&&console.warn("Notifications are denied by the user. Please enable them in your browser settings.")},showLoading:function(){var t=document.querySelector("#story-list");t&&(t.innerHTML='\n        <div class="loading">\n          <div class="spinner" aria-hidden="true"></div>\n          <span>Loading stories...</span>\n        </div>\n      ')},renderAuthenticationRequired:function(){var t=document.querySelector("#story-list"),e=document.querySelector("#map"),r=document.querySelector(".notification-actions");t&&(t.innerHTML='\n        <div class="message error" style="grid-column: 1 / -1;">\n          <i class="fas fa-lock" aria-hidden="true"></i>\n          You need to login to view stories.\n          <div style="margin-top: 1rem;">\n            <a href="#/login" class="btn">\n              <i class="fas fa-sign-in-alt" aria-hidden="true"></i>\n              Login Now\n            </a>\n          </div>\n        </div>\n      '),e&&(e.innerHTML='\n        <div class="message" style="height: 300px; display: flex; align-items: center; justify-content: center;">\n          <div style="text-align: center;">\n            <i class="fas fa-lock" style="font-size: 2rem; color: #ccc; margin-bottom: 1rem;" aria-hidden="true"></i>\n            <p>Login required to view story locations</p>\n          </div>\n        </div>\n      '),r&&(r.style.display="none")},renderStories:function(t){var e=this;return ct(st().mark((function r(){var n,o,i,a,s;return st().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=document.querySelector("#story-list"),o=document.querySelector(".notification-actions"),n){r.next=4;break}return r.abrupt("return");case 4:if(e.currentStories=t,0!==t.length){r.next=9;break}return i="favorites"===e.currentView?"No favorite stories yet. Start adding stories to your favorites!":"No stories available yet. Be the first to share your story!",n.innerHTML='\n        <div class="message" style="grid-column: 1 / -1;">\n          <i class="fas '.concat("favorites"===e.currentView?"fa-heart":"fa-info-circle",'" aria-hidden="true"></i>\n          ').concat(i,"\n        </div>\n      "),r.abrupt("return");case 9:return r.next=11,Promise.all(t.map(function(){var t=ct(st().mark((function t(e){return st().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=it,t.t1=it({},e),t.t2={},t.next=5,rt.isFavoriteStory(e.id);case 5:return t.t3=t.sent,t.t4={isFavorite:t.t3},t.abrupt("return",(0,t.t0)(t.t1,t.t2,t.t4));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 11:a=r.sent,s=a.map((function(t){return'\n        <article class="story-item" role="article" data-story-id="'.concat(t.id,'" tabindex="0">\n          <div class="story-header">\n            <div class="story-avatar" aria-hidden="true">\n              ').concat(t.name?t.name.charAt(0).toUpperCase():"U",'\n            </div>\n            <div class="story-meta">\n              <h3>').concat(t.name||"Anonymous",'</h3>\n              <div class="story-date">\n                <i class="fas fa-calendar-alt" aria-hidden="true"></i>\n                <time datetime="').concat(t.createdAt,'">\n                  ').concat(e.presenter.formatDate(t.createdAt),'\n                </time>\n              </div>\n            </div>\n            <button class="favorite-btn" data-story-id="').concat(t.id,'" title="').concat(t.isFavorite?"Remove from favorites":"Add to favorites",'"\n                    style="background: none; border: none; font-size: 1.2rem; cursor: pointer; color: ').concat(t.isFavorite?"#e74c3c":"#666",'; padding: 5px;">\n              <i class="').concat(t.isFavorite?"fas":"far",' fa-heart" aria-hidden="true"></i>\n            </button>\n          </div>\n          <div class="story-content">\n            <img\n              src="').concat(t.photoUrl,'"\n              alt="Story image by ').concat(t.name||"Anonymous",'"\n              class="story-image"\n              loading="lazy"\n            />\n            <p>').concat(e.presenter.truncateText(t.description,35),"</p>\n            ").concat(t.lat&&t.lon?'\n              <div class="story-location">\n                <i class="fas fa-map-marker-alt" aria-hidden="true"></i>\n                <span>Lat: '.concat(parseFloat(t.lat).toFixed(4),", Lon: ").concat(parseFloat(t.lon).toFixed(4),"</span>\n              </div>\n            "):"","\n          </div>\n        </article>\n      ")})).join(""),n.innerHTML=s,e.attachStoryEventListeners(),o&&(o.style.display="block");case 16:case"end":return r.stop()}}),r)})))()},attachStoryEventListeners:function(){var t=this;document.querySelectorAll(".story-item").forEach((function(e){e.addEventListener("click",(function(r){if(!r.target.closest(".favorite-btn")){var n=e.dataset.storyId;t.presenter.onStoryClick(n)}})),e.addEventListener("keydown",(function(r){if("Enter"===r.key||" "===r.key){r.preventDefault();var n=e.dataset.storyId;t.presenter.onStoryClick(n)}}))})),document.querySelectorAll(".favorite-btn").forEach((function(e){e.addEventListener("click",function(){var r=ct(st().mark((function r(n){var o;return st().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n.stopPropagation(),o=e.dataset.storyId,r.next=4,t.toggleFavorite(o);case 4:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}())}))},showError:function(t){var e=document.querySelector("#story-list"),r=document.querySelector(".notification-actions");e&&(e.innerHTML='\n        <div class="message error">\n          <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>\n          '.concat(t,"\n        </div>\n      ")),r&&(r.style.display="none")},initializeMap:function(){try{this.map&&(this.map.remove(),this.map=null),this.map=L.map("map").setView([-2.5489,118.0149],5),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(this.map),console.log("Map initialized successfully")}catch(e){console.error("Error initializing map:",e);var t=document.querySelector("#map");t&&(t.innerHTML='\n          <div class="message error" style="height: 300px; display: flex; align-items: center; justify-content: center;">\n            <div style="text-align: center;">\n              <i class="fas fa-exclamation-triangle" style="font-size: 2rem; color: #dc2626; margin-bottom: 1rem;" aria-hidden="true"></i>\n              <p>Error loading map. Please try again later.</p>\n            </div>\n          </div>\n        ')}},addStoriesToMap:function(t){var e=this;if(this.map){console.log("Adding stories to map:",t.length),this.map.eachLayer((function(t){t instanceof L.Marker&&e.map.removeLayer(t)}));var r=0,n=[];if(t.forEach((function(t){if(t.lat&&t.lon)try{var o=parseFloat(t.lat),i=parseFloat(t.lon);if(isNaN(o)||isNaN(i)||o<-90||o>90||i<-180||i>180)return void console.warn("Invalid coordinates for story ".concat(t.id,":"),o,i);var a=L.marker([o,i]).addTo(e.map);n.push([o,i]),r++;var s='\n            <div style="max-width: 250px;">\n              <img src="'.concat(t.photoUrl,'" alt="Story by ').concat(t.name||"Anonymous",'"\n                    style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px; margin-bottom: 8px;"\n                    onerror="this.style.display=\'none\';">\n              <h4 style="margin: 0 0 4px 0; font-size: 14px; font-weight: bold;">').concat(t.name||"Anonymous",'</h4>\n              <p style="margin: 0 0 8px 0; font-size: 12px; color: #666; line-height: 1.3;">\n                ').concat(e.presenter.truncateText(t.description,80),'\n              </p>\n              <div style="text-align: center;">\n                <button onclick="window.location.hash=\'#/story/').concat(t.id,'\'"\n                        style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none;\n                               padding: 6px 12px; border-radius: 4px; font-size: 11px; cursor: pointer;\n                               transition: opacity 0.2s;"\n                        onmouseover="this.style.opacity=\'0.8\'"\n                        onmouseout="this.style.opacity=\'1\'">\n                  Read More\n                </button>\n              </div>\n            </div>\n          ');a.bindPopup(s),a.bindTooltip(t.name||"Anonymous Story",{permanent:!1,direction:"top",offset:[0,-10]})}catch(e){console.error("Error adding marker for story ".concat(t.id,":"),e)}})),console.log("Added ".concat(r," markers to map")),n.length>0)try{1===n.length?this.map.setView(n[0],10):this.map.fitBounds(n,{padding:[20,20]})}catch(t){console.error("Error fitting map bounds:",t)}this.updateMapInfo(r,t.length)}else console.error("Map not initialized, cannot add stories.")},updateMapInfo:function(t,e){var r=document.querySelector(".map-subtitle");if(r){var n="favorites"===this.currentView?"favorite":"";r.textContent=0===t?"No ".concat(n," story locations available"):t===e?"Showing ".concat(t," ").concat(n," story locations"):"Showing ".concat(t," of ").concat(e," ").concat(n," story locations")}},redirectToLogin:function(){window.location.hash="#/login"},redirectToLoginAfterDelay:function(t){setTimeout((function(){window.location.hash="#/login"}),t)},navigateToStoryDetail:function(t){window.location.hash="#/story/".concat(t)}};function ht(t){return ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ht(t)}function ft(){ft=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=x(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new S(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==r&&n.call(g,i)&&(v=g);var m=d.prototype=f.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==ht(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function x(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function k(t){this.tryEntries.push(t)}function E(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(ht(e)+" is not iterable")}return p.prototype=d,u(m,"constructor",d),u(d,"constructor",p),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),u(m,s,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),E(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;E(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function pt(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function dt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,vt(n.key),n)}}function vt(t){var e=function(t){if("object"!=ht(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=ht(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ht(e)?e:e+""}const yt=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.view=e,this.model=r},e=[{key:"init",value:function(){return!this.model.isAuthenticated()||(this.view.redirectToHome(),!1)}},{key:"login",value:(r=ft().mark((function t(e,r){var n;return ft().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.view.showLoading(),(n=this.model.validateCredentials(e,r)).isValid){t.next=6;break}return this.view.showValidationErrors(n.errors),t.abrupt("return");case 6:return t.next=8,this.model.authenticate({email:e,password:r});case 8:t.sent,this.view.showSuccess("Login successful! Redirecting..."),this.view.redirectToHomeAfterDelay(1500),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(0),console.error("Login error:",t.t0),this.view.showError(t.t0.message||"Login failed. Please try again.");case 17:return t.prev=17,this.view.hideLoading(),t.finish(17);case 20:case"end":return t.stop()}}),t,this,[[0,13,17,20]])})),n=function(){var t=this,e=arguments;return new Promise((function(n,o){var i=r.apply(t,e);function a(t){pt(i,n,o,a,s,"next",t)}function s(t){pt(i,n,o,a,s,"throw",t)}a(void 0)}))},function(t,e){return n.apply(this,arguments)})},{key:"onEmailBlur",value:function(t){t?this.model.isValidEmail(t)?this.view.hideFieldError("email"):this.view.showFieldError("email","Please enter a valid email address"):this.view.showFieldError("email","Email is required")}},{key:"onPasswordBlur",value:function(t){t?t.length<8?this.view.showFieldError("password","Password must be at least 8 characters long"):this.view.hideFieldError("password"):this.view.showFieldError("password","Password is required")}},{key:"validateEmail",value:function(t){return this.model.isValidEmail(t)}},{key:"validateForm",value:function(t,e){return this.model.validateCredentials(t,e)}}],e&&dt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function gt(t){return gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gt(t)}function mt(){mt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=x(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new S(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==r&&n.call(g,i)&&(v=g);var m=d.prototype=f.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==gt(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function x(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function k(t){this.tryEntries.push(t)}function E(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(gt(e)+" is not iterable")}return p.prototype=d,u(m,"constructor",d),u(d,"constructor",p),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),u(m,s,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),E(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;E(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function wt(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function bt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,xt(n.key),n)}}function xt(t){var e=function(t){if("object"!=gt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=gt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==gt(e)?e:e+""}const kt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.user=null},e=[{key:"authenticate",value:(r=mt().mark((function t(e){var r;return mt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c.default.login(e);case 3:if(!(r=t.sent).error){t.next=6;break}throw new Error(r.message);case 6:return this.user=r.loginResult,h.saveToken(r.loginResult.token),t.abrupt("return",r.loginResult);case 11:throw t.prev=11,t.t0=t.catch(0),console.error("Error in LoginModel.authenticate:",t.t0),t.t0;case 15:case"end":return t.stop()}}),t,this,[[0,11]])})),n=function(){var t=this,e=arguments;return new Promise((function(n,o){var i=r.apply(t,e);function a(t){wt(i,n,o,a,s,"next",t)}function s(t){wt(i,n,o,a,s,"throw",t)}a(void 0)}))},function(t){return n.apply(this,arguments)})},{key:"isAuthenticated",value:function(){return h.isLoggedIn()}},{key:"getCurrentUser",value:function(){return this.user}},{key:"clearAuthData",value:function(){this.user=null,h.logout()}},{key:"validateCredentials",value:function(t,e){var r={};return t?this.isValidEmail(t)||(r.email="Please enter a valid email address"):r.email="Email is required",e?e.length<8&&(r.password="Password must be at least 8 characters long"):r.password="Password is required",{isValid:0===Object.keys(r).length,errors:r}}},{key:"isValidEmail",value:function(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}}],e&&bt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function Et(t){return Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Et(t)}function St(){St=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=x(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new S(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==r&&n.call(g,i)&&(v=g);var m=d.prototype=f.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==Et(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function x(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function k(t){this.tryEntries.push(t)}function E(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(Et(e)+" is not iterable")}return p.prototype=d,u(m,"constructor",d),u(d,"constructor",p),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),u(m,s,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),E(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;E(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function _t(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function Ot(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){_t(i,n,o,a,s,"next",t)}function s(t){_t(i,n,o,a,s,"throw",t)}a(void 0)}))}}const Pt={presenter:null,model:null,render:function(){return Ot(St().mark((function t(){return St().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n      <div class="form-container">\n        <h2 class="form-title">\n          <i class="fas fa-sign-in-alt" aria-hidden="true"></i>\n          Login to Your Account\n        </h2>\n        \n        <div id="login-message"></div>\n        \n        <form id="login-form" novalidate>\n          <div class="form-group">\n            <label for="email">Email Address</label>\n            <input \n              type="email" \n              id="email" \n              name="email" \n              required \n              autocomplete="email"\n              aria-describedby="email-error"\n              placeholder="Enter your email address"\n            />\n            <div id="email-error" class="error-message" style="display: none;" role="alert"></div>\n          </div>\n          \n          <div class="form-group">\n            <label for="password">Password</label>\n            <input \n              type="password" \n              id="password" \n              name="password" \n              required \n              autocomplete="current-password"\n              aria-describedby="password-error"\n              placeholder="Enter your password"\n            />\n            <div id="password-error" class="error-message" style="display: none;" role="alert"></div>\n          </div>\n          \n          <button type="submit" class="btn" id="login-button">\n            <i class="fas fa-sign-in-alt" aria-hidden="true"></i>\n            Login\n          </button>\n        </form>\n        \n        <div style="text-align: center; margin-top: 1.5rem;">\n          <p>Don\'t have an account? <a href="#/register" style="color: #667eea; text-decoration: none;">Register here</a></p>\n        </div>\n      </div>\n    ');case 1:case"end":return t.stop()}}),t)})))()},afterRender:function(){var t=this;return Ot(St().mark((function e(){return St().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.model=new kt,t.presenter=new yt(t,t.model),t.presenter.init()){e.next=4;break}return e.abrupt("return");case 4:t.setupEventListeners();case 5:case"end":return e.stop()}}),e)})))()},setupEventListeners:function(){var t=this,e=document.querySelector("#login-form"),r=document.querySelector("#email"),n=document.querySelector("#password");r.addEventListener("blur",(function(){var e=r.value.trim();t.presenter.onEmailBlur(e)})),n.addEventListener("blur",(function(){var e=n.value;t.presenter.onPasswordBlur(e)})),e.addEventListener("submit",function(){var e=Ot(St().mark((function e(o){var i,a;return St().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.preventDefault(),i=r.value.trim(),a=n.value,e.next=5,t.presenter.login(i,a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},showFieldError:function(t,e){var r=document.querySelector("#".concat(t)),n=document.querySelector("#".concat(t,"-error"));r&&(r.style.borderColor="#dc2626"),n&&(n.textContent=e,n.style.display="block")},hideFieldError:function(t){var e=document.querySelector("#".concat(t)),r=document.querySelector("#".concat(t,"-error"));e&&(e.style.borderColor="rgba(102, 126, 234, 0.2)"),r&&(r.style.display="none")},showValidationErrors:function(t){var e=this;this.hideFieldError("email"),this.hideFieldError("password"),Object.keys(t).forEach((function(r){e.showFieldError(r,t[r])}))},showMessage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error",r=document.querySelector("#login-message");r&&(r.innerHTML='\n        <div class="message '.concat(e,'" role="alert">\n            <i class="fas fa-').concat("error"===e?"exclamation-triangle":"check-circle",'" aria-hidden="true"></i>\n            ').concat(t,"\n        </div>\n        "))},showError:function(t){this.showMessage(t,"error")},showSuccess:function(t){this.showMessage(t,"success")},showLoading:function(){var t=document.querySelector("#login-button");t&&(t.disabled=!0,t.innerHTML='\n        <div class="spinner" style="width: 16px; height: 16px; margin-right: 0.5rem;" aria-hidden="true"></div>\n        Logging in...\n        ')},hideLoading:function(){var t=document.querySelector("#login-button");t&&(t.disabled=!1,t.innerHTML='\n        <i class="fas fa-sign-in-alt" aria-hidden="true"></i>\n        Login\n        ')},redirectToHome:function(){window.location.hash="#/home"},redirectToHomeAfterDelay:function(t){setTimeout((function(){window.location.hash="#/home"}),t)}};function jt(t){return jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jt(t)}function Tt(){Tt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=x(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new S(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==r&&n.call(g,i)&&(v=g);var m=d.prototype=f.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==jt(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function x(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function k(t){this.tryEntries.push(t)}function E(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(jt(e)+" is not iterable")}return p.prototype=d,u(m,"constructor",d),u(d,"constructor",p),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),u(m,s,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),E(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;E(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function Lt(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function Ft(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Lt(i,n,o,a,s,"next",t)}function s(t){Lt(i,n,o,a,s,"throw",t)}a(void 0)}))}}function At(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Nt(n.key),n)}}function Nt(t){var e=function(t){if("object"!=jt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=jt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==jt(e)?e:e+""}const It=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.view=e,this.model=r},e=[{key:"init",value:(n=Ft(Tt().mark((function t(){return Tt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.model.isUserLoggedIn();case 2:if(!t.sent){t.next=6;break}return this.view.redirectToHome(),t.abrupt("return",!1);case 6:return t.abrupt("return",!0);case 7:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"register",value:(r=Ft(Tt().mark((function t(e,r,n){var o,i;return Tt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.view.showLoading(),(o=this.model.validateForm(e,r,n)).isValid){t.next=6;break}return this.view.showValidationErrors(o.errors),t.abrupt("return");case 6:return t.next=8,this.model.registerUser({name:e,email:r,password:n});case 8:if((i=t.sent).success){t.next=11;break}throw new Error(i.error);case 11:this.view.showSuccess("Account created successfully! Redirecting to login..."),this.view.redirectToLoginAfterDelay(2e3),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(0),console.error("Registration error:",t.t0),this.view.showError(t.t0.message||"Registration failed. Please try again.");case 19:return t.prev=19,this.view.hideLoading(),t.finish(19);case 22:case"end":return t.stop()}}),t,this,[[0,15,19,22]])}))),function(t,e,n){return r.apply(this,arguments)})},{key:"onNameBlur",value:function(t){var e=this.model.validateField("name",t);e.isValid?this.view.hideFieldError("name"):this.view.showFieldError("name",e.error)}},{key:"onEmailBlur",value:function(t){var e=this.model.validateField("email",t);e.isValid?this.view.hideFieldError("email"):this.view.showFieldError("email",e.error)}},{key:"onPasswordBlur",value:function(t){var e=this.model.validateField("password",t);e.isValid?this.view.hideFieldError("password"):this.view.showFieldError("password",e.error)}}],e&&At(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function Gt(t){return Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gt(t)}function Dt(){Dt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=x(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new S(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==r&&n.call(g,i)&&(v=g);var m=d.prototype=f.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==Gt(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function x(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function k(t){this.tryEntries.push(t)}function E(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(Gt(e)+" is not iterable")}return p.prototype=d,u(m,"constructor",d),u(d,"constructor",p),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),u(m,s,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),E(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;E(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function Ct(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function qt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Mt(n.key),n)}}function Mt(t){var e=function(t){if("object"!=Gt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Gt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Gt(e)?e:e+""}const Bt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.apiService=c.default,this.authService=h},e=[{key:"isUserLoggedIn",value:function(){return this.authService.isLoggedIn()}},{key:"validateEmail",value:function(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}},{key:"validateForm",value:function(t,e,r){var n={};return t?t.length<2&&(n.name="Name must be at least 2 characters long"):n.name="Full name is required",e?this.validateEmail(e)||(n.email="Please enter a valid email address"):n.email="Email is required",r?r.length<8&&(n.password="Password must be at least 8 characters long"):n.password="Password is required",{isValid:0===Object.keys(n).length,errors:n}}},{key:"validateField",value:function(t,e){switch(t){case"name":if(!e)return{isValid:!1,error:"Full name is required"};if(e.length<2)return{isValid:!1,error:"Name must be at least 2 characters long"};break;case"email":if(!e)return{isValid:!1,error:"Email is required"};if(!this.validateEmail(e))return{isValid:!1,error:"Please enter a valid email address"};break;case"password":if(!e)return{isValid:!1,error:"Password is required"};if(e.length<8)return{isValid:!1,error:"Password must be at least 8 characters long"};break;default:return{isValid:!0}}return{isValid:!0}}},{key:"registerUser",value:(r=Dt().mark((function t(e){var r;return Dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.apiService.register(e);case 3:if(!(r=t.sent).error){t.next=6;break}throw new Error(r.message);case 6:return t.abrupt("return",{success:!0,data:r,message:"Account created successfully!"});case 9:return t.prev=9,t.t0=t.catch(0),t.abrupt("return",{success:!1,error:t.t0.message||"Registration failed. Please try again."});case 12:case"end":return t.stop()}}),t,this,[[0,9]])})),n=function(){var t=this,e=arguments;return new Promise((function(n,o){var i=r.apply(t,e);function a(t){Ct(i,n,o,a,s,"next",t)}function s(t){Ct(i,n,o,a,s,"throw",t)}a(void 0)}))},function(t){return n.apply(this,arguments)})}],e&&qt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function Vt(t){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vt(t)}function Rt(){Rt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=x(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new S(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==r&&n.call(g,i)&&(v=g);var m=d.prototype=f.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==Vt(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function x(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function k(t){this.tryEntries.push(t)}function E(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(Vt(e)+" is not iterable")}return p.prototype=d,u(m,"constructor",d),u(d,"constructor",p),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),u(m,s,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),E(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;E(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function Ut(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function Ht(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ut(i,n,o,a,s,"next",t)}function s(t){Ut(i,n,o,a,s,"throw",t)}a(void 0)}))}}const Yt={presenter:null,model:null,render:function(){return Ht(Rt().mark((function t(){return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n      <div class="form-container">\n        <h2 class="form-title">\n          <i class="fas fa-user-plus" aria-hidden="true"></i>\n          Create Your Account\n        </h2>\n\n        <div id="register-message"></div>\n\n        <form id="register-form" novalidate>\n          <div class="form-group">\n            <label for="name">Full Name</label>\n            <input\n              type="text"\n              id="name"\n              name="name"\n              required\n              autocomplete="name"\n              aria-describedby="name-error"\n              placeholder="Enter your full name"\n            />\n            <div id="name-error" class="error-message" style="display: none;" role="alert"></div>\n          </div>\n\n          <div class="form-group">\n            <label for="email">Email Address</label>\n            <input\n              type="email"\n              id="email"\n              name="email"\n              required\n              autocomplete="email"\n              aria-describedby="email-error"\n              placeholder="Enter your email address"\n            />\n            <div id="email-error" class="error-message" style="display: none;" role="alert"></div>\n          </div>\n\n          <div class="form-group">\n            <label for="password">Password</label>\n            <input\n              type="password"\n              id="password"\n              name="password"\n              required\n              autocomplete="new-password"\n              aria-describedby="password-error"\n              placeholder="Enter your password"\n            />\n            <div id="password-error" class="error-message" style="display: none;" role="alert"></div>\n          </div>\n\n          <button type="submit" class="btn" id="register-button">\n            <i class="fas fa-user-plus" aria-hidden="true"></i>\n            Create Account\n          </button>\n        </form>\n\n        <div style="text-align: center; margin-top: 1.5rem;">\n          <p>Already have an account? <a href="#/login" style="color: #667eea; text-decoration: none;">Login here</a></p>\n        </div>\n      </div>\n    ');case 1:case"end":return t.stop()}}),t)})))()},afterRender:function(){var t=this;return Ht(Rt().mark((function e(){return Rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.model=new Bt,t.presenter=new It(t,t.model),e.next=4,t.presenter.init();case 4:if(e.sent){e.next=7;break}return e.abrupt("return");case 7:t._setupEventListeners();case 8:case"end":return e.stop()}}),e)})))()},_setupEventListeners:function(){var t=this,e=document.querySelector("#register-form"),r=document.querySelector("#name"),n=document.querySelector("#email"),o=document.querySelector("#password");r.addEventListener("blur",(function(){var e=r.value.trim();t.presenter.onNameBlur(e)})),n.addEventListener("blur",(function(){var e=n.value.trim();t.presenter.onEmailBlur(e)})),o.addEventListener("blur",(function(){var e=o.value;t.presenter.onPasswordBlur(e)})),e.addEventListener("submit",function(){var e=Ht(Rt().mark((function e(i){var a,s,u;return Rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.preventDefault(),a=r.value.trim(),s=n.value.trim(),u=o.value,e.next=6,t.presenter.register(a,s,u);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},showFieldError:function(t,e){var r=document.querySelector("#".concat(t)),n=document.querySelector("#".concat(t,"-error"));r&&(r.style.borderColor="#dc2626"),n&&(n.textContent=e,n.style.display="block")},hideFieldError:function(t){var e=document.querySelector("#".concat(t)),r=document.querySelector("#".concat(t,"-error"));e&&(e.style.borderColor="rgba(102, 126, 234, 0.2)"),r&&(r.style.display="none")},showValidationErrors:function(t){var e=this;this.hideFieldError("name"),this.hideFieldError("email"),this.hideFieldError("password"),Object.keys(t).forEach((function(r){e.showFieldError(r,t[r])}))},showMessage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error";document.querySelector("#register-message").innerHTML='\n      <div class="message '.concat(e,'" role="alert">\n        <i class="fas fa-').concat("error"===e?"exclamation-triangle":"check-circle",'" aria-hidden="true"></i>\n        ').concat(t,"\n      </div>\n    ")},showError:function(t){this.showMessage(t,"error")},showSuccess:function(t){this.showMessage(t,"success")},showLoading:function(){var t=document.querySelector("#register-button");t.disabled=!0,t.innerHTML='\n      <div class="spinner" style="width: 16px; height: 16px; margin-right: 0.5rem;" aria-hidden="true"></div>\n      Creating Account...\n    '},hideLoading:function(){var t=document.querySelector("#register-button");t.disabled=!1,t.innerHTML='\n      <i class="fas fa-user-plus" aria-hidden="true"></i>\n      Create Account\n    '},redirectToHome:function(){window.location.hash="#/home"},redirectToLoginAfterDelay:function(t){setTimeout((function(){window.location.hash="#/login"}),t)}};function zt(t){return zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zt(t)}function Wt(){Wt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=x(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new S(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==r&&n.call(g,i)&&(v=g);var m=d.prototype=f.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==zt(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function x(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function k(t){this.tryEntries.push(t)}function E(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(zt(e)+" is not iterable")}return p.prototype=d,u(m,"constructor",d),u(d,"constructor",p),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),u(m,s,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),E(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;E(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function Jt(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function Qt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Jt(i,n,o,a,s,"next",t)}function s(t){Jt(i,n,o,a,s,"throw",t)}a(void 0)}))}}function Kt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,$t(n.key),n)}}function $t(t){var e=function(t){if("object"!=zt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=zt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==zt(e)?e:e+""}const Xt=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.view=e,this.model=r,this.stream=null,this.map=null,this.marker=null,this.isActive=!0},e=[{key:"init",value:(i=Qt(Wt().mark((function t(){return Wt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.model.isUserLoggedIn();case 2:if(t.sent){t.next=6;break}return this.view.renderAuthenticationRequired(),t.abrupt("return",!1);case 6:return this.initializeCameraControls(),this.initializeLocationMap(),t.abrupt("return",!0);case 9:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"initializeCameraControls",value:function(){var t=this;this.view.setupCameraControls({onStartCamera:function(){return t.startCamera()},onCapture:function(){return t.capturePhoto()},onRetake:function(){return t.retakePhoto()},onUpload:function(e){return t.handleFileUpload(e)}})}},{key:"startCamera",value:(o=Qt(Wt().mark((function t(){return Wt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.isActive){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});case 5:if(this.stream=t.sent,this.isActive){t.next=9;break}return this.stopCamera(),t.abrupt("return");case 9:this.view.showCameraPreview(this.stream),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("Error accessing camera:",t.t0),this.isActive&&this.view.showError("Unable to access camera. Please check permissions.");case 16:case"end":return t.stop()}}),t,this,[[0,12]])}))),function(){return o.apply(this,arguments)})},{key:"capturePhoto",value:(n=Qt(Wt().mark((function t(){var e,r,n,o,i,a;return Wt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.stream&&this.isActive){t.next=2;break}return t.abrupt("return");case 2:if(e=this.view.getCaptureCanvas()){t.next=5;break}return t.abrupt("return");case 5:return r=e.canvas,n=e.context,t.next=8,this.view.captureFromVideo(r,n);case 8:(o=t.sent)&&this.isActive&&(i=new File([o],"captured-photo.jpg",{type:"image/jpeg"}),this.model.setCapturedPhoto(i),a=URL.createObjectURL(i),this.view.showPhotoPreview(a),this.stopCamera());case 10:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"retakePhoto",value:function(){this.isActive&&(this.view.hidePhotoPreview(),this.model.setCapturedPhoto(null),this.view.showRetakeControls())}},{key:"handleFileUpload",value:function(t){if(t&&this.isActive){this.stopCamera(),this.model.setCapturedPhoto(t);var e=URL.createObjectURL(t);this.view.showPhotoPreview(e)}}},{key:"stopCamera",value:function(){if(this.stream)try{this.stream.getTracks().forEach((function(t){t.stop(),console.log("Camera track stopped:",t.label)})),this.stream=null;var t=document.querySelector("#camera-preview");t&&(t.srcObject=null,t.style.display="none"),console.log("Camera stopped successfully")}catch(t){console.error("Error stopping camera:",t)}}},{key:"initializeLocationMap",value:function(){var t=this;this.isActive&&setTimeout((function(){if(t.isActive)try{t.map=L.map("location-map").setView([-2.5489,118.0149],5),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(t.map),t.map.on("click",(function(e){return t.onMapClick(e)}))}catch(t){console.error("Error initializing map:",t)}}),100)}},{key:"onMapClick",value:function(t){if(this.isActive){var e=t.latlng.lat,r=t.latlng.lng,n={lat:e,lon:r};this.model.setSelectedLocation(n),this.view.updateLocationInputs(e,r),this.marker?this.marker.setLatLng([e,r]):this.marker=L.marker([e,r]).addTo(this.map).bindPopup("Story Location").openPopup()}}},{key:"submitStory",value:(r=Qt(Wt().mark((function t(e){var r,n;return Wt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isActive){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,this.model.isUserLoggedIn()){t.next=6;break}return this.view.showError("You must login to share a story."),t.abrupt("return");case 6:if(this.view.showLoading(),this.model.setDescription(e),(r=this.model.validateStoryData()).isValid){t.next=13;break}return this.view.showValidationErrors(r.errors),this.view.hideLoading(),t.abrupt("return");case 13:return t.next=15,this.model.submitStoryToServer();case 15:if(n=t.sent,this.isActive){t.next=18;break}return t.abrupt("return");case 18:if(!n.error){t.next=24;break}if(!n.message||!n.message.includes("token")&&!n.message.includes("unauthorized")){t.next=23;break}return this.model.logoutUser(),this.view.showError("Your session has expired. Please login again."),t.abrupt("return");case 23:throw new Error(n.message);case 24:this.view.showSuccess("Story shared successfully!"),this.cleanup(),this.view.redirectToHomeAfterDelay(2e3),t.next=39;break;case 29:if(t.prev=29,t.t0=t.catch(2),console.error("Add story error:",t.t0),this.isActive){t.next=34;break}return t.abrupt("return");case 34:if(!t.t0.message||!t.t0.message.includes("token")&&!t.t0.message.includes("unauthorized")){t.next=38;break}return this.model.logoutUser(),this.view.showError("Your session has expired. Please login again."),t.abrupt("return");case 38:this.view.showError(t.t0.message||"Failed to share story. Please try again.");case 39:return t.prev=39,this.isActive&&this.view.hideLoading(),t.finish(39);case 42:case"end":return t.stop()}}),t,this,[[2,29,39,42]])}))),function(t){return r.apply(this,arguments)})},{key:"onDescriptionBlur",value:function(t){if(this.isActive){var e=this.model.validateDescription(t);e?this.view.showFieldError("description",e):this.view.hideFieldError("description")}}},{key:"cleanup",value:function(){if(console.log("Cleaning up AddStoryPresenter..."),this.isActive=!1,this.stopCamera(),this.map)try{this.map.remove(),this.map=null,this.marker=null,console.log("Map cleaned up")}catch(t){console.error("Error cleaning up map:",t)}var t=this.model.getCapturedPhoto();if(t&&t instanceof File)try{var e=document.querySelector("#photo-preview");e&&e.src&&URL.revokeObjectURL(e.src)}catch(t){console.error("Error revoking object URL:",t)}this.model.reset(),console.log("AddStoryPresenter cleanup completed")}},{key:"isPresenterActive",value:function(){return this.isActive}}],e&&Kt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i}();function Zt(t){return Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zt(t)}function te(){te=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=x(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new S(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==r&&n.call(g,i)&&(v=g);var m=d.prototype=f.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==Zt(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function x(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function k(t){this.tryEntries.push(t)}function E(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(Zt(e)+" is not iterable")}return p.prototype=d,u(m,"constructor",d),u(d,"constructor",p),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),u(m,s,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),E(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;E(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function ee(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function re(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ee(Object(r),!0).forEach((function(e){ne(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ne(t,e,r){return(e=ae(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function oe(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function ie(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ae(n.key),n)}}function ae(t){var e=function(t){if("object"!=Zt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Zt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Zt(e)?e:e+""}const se=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.capturedPhoto=null,this.selectedLocation=null,this.description=""},e=[{key:"isUserLoggedIn",value:function(){return h.isLoggedIn()}},{key:"logoutUser",value:function(){h.logout()}},{key:"setCapturedPhoto",value:function(t){this.capturedPhoto=t}},{key:"getCapturedPhoto",value:function(){return this.capturedPhoto}},{key:"setSelectedLocation",value:function(t){this.selectedLocation=t}},{key:"getSelectedLocation",value:function(){return this.selectedLocation}},{key:"setDescription",value:function(t){this.description=t.trim()}},{key:"getDescription",value:function(){return this.description}},{key:"validateStoryData",value:function(){var t={};return this.description?this.description.length<10&&(t.description="Description must be at least 10 characters long"):t.description="Story description is required",this.capturedPhoto||(t.photo="Please capture or upload a photo"),{isValid:0===Object.keys(t).length,errors:t}}},{key:"submitStoryToServer",value:(r=te().mark((function t(){var e;return te().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=re({description:this.description,photo:this.capturedPhoto},this.selectedLocation&&{lat:this.selectedLocation.lat,lon:this.selectedLocation.lon}),t.next=3,c.default.addStory(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})),n=function(){var t=this,e=arguments;return new Promise((function(n,o){var i=r.apply(t,e);function a(t){oe(i,n,o,a,s,"next",t)}function s(t){oe(i,n,o,a,s,"throw",t)}a(void 0)}))},function(){return n.apply(this,arguments)})},{key:"reset",value:function(){this.capturedPhoto=null,this.selectedLocation=null,this.description=""}},{key:"validateDescription",value:function(t){return t?t.length<10?"Description must be at least 10 characters long":null:"Story description is required"}},{key:"hasValidStoryData",value:function(){return this.description&&this.capturedPhoto}}],e&&ie(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function ue(t){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ue(t)}function ce(){ce=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=x(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new S(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==r&&n.call(g,i)&&(v=g);var m=d.prototype=f.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==ue(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function x(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function k(t){this.tryEntries.push(t)}function E(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(ue(e)+" is not iterable")}return p.prototype=d,u(m,"constructor",d),u(d,"constructor",p),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),u(m,s,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),E(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;E(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function le(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function he(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){le(i,n,o,a,s,"next",t)}function s(t){le(i,n,o,a,s,"throw",t)}a(void 0)}))}}const fe={presenter:null,model:null,render:function(){return he(ce().mark((function t(){return ce().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n      <div class="form-container">\n        <h2 class="form-title">\n          <i class="fas fa-plus-circle" aria-hidden="true"></i>\n          Share Your Story\n        </h2>\n        \n        <div id="add-story-message"></div>\n        \n        <form id="add-story-form" novalidate>\n          <div class="form-group">\n            <label for="description">Story Description</label>\n            <textarea \n              id="description" \n              name="description" \n              required \n              aria-describedby="description-error"\n              placeholder="Tell us about your amazing experience..."\n              rows="5"\n            ></textarea>\n            <div id="description-error" class="error-message" style="display: none;" role="alert"></div>\n          </div>\n          \n          <div class="form-group">\n            <label for="photo-input">Photo</label>\n            <input \n              type="file" \n              id="photo-input" \n              name="photo" \n              accept="image/*" \n              required\n              aria-describedby="photo-error"\n              style="display: none;"\n            />\n            <div class="camera-container">\n              <video id="camera-preview" autoplay playsinline style="display: none;" aria-label="Camera preview"></video>\n              <canvas id="photo-canvas" style="display: none;"></canvas>\n              <img id="photo-preview" style="display: none;" alt="Captured photo preview" />\n              \n              <div class="camera-controls">\n                <button type="button" id="start-camera-btn" class="btn btn-secondary">\n                  <i class="fas fa-video" aria-hidden="true"></i>\n                  Start Camera\n                </button>\n                <button type="button" id="capture-btn" class="btn" style="display: none;">\n                  <i class="fas fa-camera" aria-hidden="true"></i>\n                  Capture Photo\n                </button>\n                <button type="button" id="retake-btn" class="btn btn-secondary" style="display: none;">\n                  <i class="fas fa-redo" aria-hidden="true"></i>\n                  Retake\n                </button>\n                \n              </div>\n            </div>\n            <div id="photo-error" class="error-message" style="display: none;" role="alert"></div>\n          </div>\n          \n          <div class="form-group">\n            <div class="map-container" style="margin-bottom: 1rem;">\n              <div class="map-header">\n                <h4 class="map-title">Select Location</h4>\n                <p class="map-subtitle">Click on the map to set your story location (optional)</p>\n              </div>\n              <div id="location-map" style="height: 300px; border-radius: 15px;"></div>\n            </div>\n            <div style="display: flex; gap: 1rem;">\n              <div style="flex: 1;">\n                <label for="latitude">Latitude</label>\n                <input type="number" id="latitude" step="any" readonly placeholder="Click on map">\n              </div>\n              <div style="flex: 1;">\n                <label for="longitude">Longitude</label>\n                <input type="number" id="longitude" step="any" readonly placeholder="Click on map">\n              </div>\n            </div>\n          </div>\n          \n          <button type="submit" class="btn" id="submit-story-btn">\n            <i class="fas fa-share" aria-hidden="true"></i>\n            Share Story\n          </button>\n        </form>\n      </div>\n    ');case 1:case"end":return t.stop()}}),t)})))()},afterRender:function(){var t=this;return he(ce().mark((function e(){return ce().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.model=new se,t.presenter=new Xt(t,t.model),e.next=4,t.presenter.init();case 4:t._setupEventListeners(),t._setupPageChangeListeners();case 6:case"end":return e.stop()}}),e)})))()},_setupEventListeners:function(){var t=this,e=document.querySelector("#add-story-form"),r=document.querySelector("#description");r.addEventListener("blur",(function(){var e=r.value.trim();t.presenter.onDescriptionBlur(e)})),e.addEventListener("submit",function(){var e=he(ce().mark((function e(n){var o;return ce().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),o=r.value.trim(),e.next=4,t.presenter.submitStory(o);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},_setupPageChangeListeners:function(){var t=this;window.addEventListener("hashchange",(function(){t._cleanup()})),window.addEventListener("beforeunload",(function(){t._cleanup()})),document.addEventListener("visibilitychange",(function(){document.hidden&&t._cleanup()})),window.addEventListener("blur",(function(){t._cleanup()}))},_cleanup:function(){this.presenter&&this.presenter.cleanup()},beforeDestroy:function(){this._cleanup()},renderAuthenticationRequired:function(){document.querySelector("#add-story-message").innerHTML='\n      <div class="message error" role="alert">\n        <i class="fas fa-lock" aria-hidden="true"></i>\n        You need to login to share your story.\n        <div style="margin-top: 1rem;">\n          <a href="#/login" class="btn">\n            <i class="fas fa-sign-in-alt" aria-hidden="true"></i>\n            Login\n          </a>\n        </div>\n      </div>\n    ';var t=document.querySelector("#add-story-form");t&&(t.style.display="none")},setupCameraControls:function(t){var e=document.querySelector("#start-camera-btn"),r=document.querySelector("#capture-btn"),n=document.querySelector("#retake-btn"),o=document.querySelector("#upload-btn"),i=document.querySelector("#photo-input");null==e||e.addEventListener("click",t.onStartCamera),null==r||r.addEventListener("click",t.onCapture),null==n||n.addEventListener("click",t.onRetake),null==o||o.addEventListener("click",(function(){return i.click()})),null==i||i.addEventListener("change",(function(e){var r=e.target.files[0];r&&t.onUpload(r)}))},showCameraPreview:function(t){var e=document.querySelector("#camera-preview"),r=document.querySelector("#photo-preview"),n=document.querySelector("#start-camera-btn"),o=document.querySelector("#capture-btn"),i=document.querySelector("#retake-btn");e&&(e.srcObject=t,e.style.display="block"),r&&(r.style.display="none"),n&&(n.style.display="none"),o&&(o.style.display="inline-flex"),i&&(i.style.display="none")},getCaptureCanvas:function(){var t=document.querySelector("#camera-preview"),e=document.querySelector("#photo-canvas");return t&&e?(e.width=t.videoWidth,e.height=t.videoHeight,{canvas:e,context:e.getContext("2d")}):null},captureFromVideo:function(t,e){var r=document.querySelector("#camera-preview");return r&&t&&e?(e.drawImage(r,0,0),new Promise((function(e){t.toBlob(e,"image/jpeg",.8)}))):null},showPhotoPreview:function(t){var e=document.querySelector("#camera-preview"),r=document.querySelector("#photo-preview"),n=document.querySelector("#capture-btn"),o=document.querySelector("#retake-btn"),i=document.querySelector("#start-camera-btn");r&&(r.src=t,r.style.display="block"),e&&(e.style.display="none"),n&&(n.style.display="none"),o&&(o.style.display="inline-flex"),i&&(i.style.display="none")},hidePhotoPreview:function(){var t=document.querySelector("#photo-preview");t&&(t.style.display="none")},showRetakeControls:function(){var t=document.querySelector("#retake-btn"),e=document.querySelector("#start-camera-btn");t&&(t.style.display="none"),e&&(e.style.display="inline-flex")},updateLocationInputs:function(t,e){var r=document.querySelector("#latitude"),n=document.querySelector("#longitude");r&&(r.value=t.toFixed(6)),n&&(n.value=e.toFixed(6))},showFieldError:function(t,e){var r=document.querySelector("#".concat(t)),n=document.querySelector("#".concat(t,"-error"));r&&(r.style.borderColor="#dc2626"),n&&(n.textContent=e,n.style.display="block")},hideFieldError:function(t){var e=document.querySelector("#".concat(t)),r=document.querySelector("#".concat(t,"-error"));e&&(e.style.borderColor="rgba(102, 126, 234, 0.2)"),r&&(r.style.display="none")},showValidationErrors:function(t){var e=this;this.hideFieldError("description"),this.hideFieldError("photo"),Object.keys(t).forEach((function(r){e.showFieldError(r,t[r])}))},showMessage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error",r=document.querySelector("#add-story-message");r&&(r.innerHTML='\n        <div class="message '.concat(e,'" role="alert">\n          <i class="fas fa-').concat("error"===e?"exclamation-triangle":"check-circle",'" aria-hidden="true"></i>\n          ').concat(t,"\n        </div>\n      "))},showError:function(t){this.showMessage(t,"error")},showSuccess:function(t){this.showMessage(t,"success")},showLoading:function(){var t=document.querySelector("#submit-story-btn");t&&(t.disabled=!0,t.innerHTML='\n        <div class="spinner" style="width: 16px; height: 16px; margin-right: 0.5rem;" aria-hidden="true"></div>\n        Sharing Story...\n      ')},hideLoading:function(){var t=document.querySelector("#submit-story-btn");t&&(t.disabled=!1,t.innerHTML='\n        <i class="fas fa-share" aria-hidden="true"></i>\n        Share Story\n      ')},redirectToHomeAfterDelay:function(t){setTimeout((function(){window.location.hash="#/home"}),t)},redirectToLoginAfterDelay:function(t){setTimeout((function(){window.location.hash="#/login"}),t)}};function pe(t){return pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pe(t)}function de(){de=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=x(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new S(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==r&&n.call(g,i)&&(v=g);var m=d.prototype=f.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==pe(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function x(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function k(t){this.tryEntries.push(t)}function E(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(pe(e)+" is not iterable")}return p.prototype=d,u(m,"constructor",d),u(d,"constructor",p),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),u(m,s,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),E(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;E(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function ve(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function ye(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ve(i,n,o,a,s,"next",t)}function s(t){ve(i,n,o,a,s,"throw",t)}a(void 0)}))}}function ge(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,me(n.key),n)}}function me(t){var e=function(t){if("object"!=pe(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=pe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==pe(e)?e:e+""}const we=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.view=e,this.model=r,this.map=null},e=[{key:"init",value:(n=ye(de().mark((function t(){var e;return de().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.model.isUserAuthenticated()){t.next=4;break}return this.view.renderAuthenticationRequired(),this.view.redirectToLogin(),t.abrupt("return");case 4:if(e=this.model.getStoryIdFromUrl()){t.next=9;break}return this.view.showError("Story ID not found"),this.view.redirectToHomeAfterDelay(2e3),t.abrupt("return");case 9:return t.next=11,this.loadStoryDetail(e);case 11:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"loadStoryDetail",value:(r=ye(de().mark((function t(e){var r,n;return de().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.view.showLoading(),t.next=4,this.model.fetchStoryById(e);case 4:if((r=t.sent).success){t.next=12;break}if(!r.isAuthError){t.next=11;break}return this.model.logoutUser(),this.view.renderAuthenticationRequired(),this.view.redirectToLoginAfterDelay(2e3),t.abrupt("return");case 11:throw new Error(r.error);case 12:this.view.renderStoryDetail(r.data),this.model.hasLocation()&&(n=this.model.getLocation(),this.view.initializeStoryMap(n.lat,n.lon,n.name)),t.next=21;break;case 16:t.prev=16,t.t0=t.catch(0),console.error("Error loading story detail:",t.t0),this.view.showError(t.t0.message||"Failed to load story details"),this.view.redirectToHomeAfterDelay(3e3);case 21:case"end":return t.stop()}}),t,this,[[0,16]])}))),function(t){return r.apply(this,arguments)})},{key:"formatDate",value:function(t){return this.model.formatDate(t)}},{key:"truncateText",value:function(t,e){return this.model.truncateText(t,e)}},{key:"onBackToStories",value:function(){this.view.navigateToHome()}},{key:"cleanup",value:function(){this.view.cleanupMap()}}],e&&ge(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function be(t){return be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},be(t)}function xe(){xe=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=x(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new S(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==r&&n.call(g,i)&&(v=g);var m=d.prototype=f.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==be(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function x(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function k(t){this.tryEntries.push(t)}function E(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(be(e)+" is not iterable")}return p.prototype=d,u(m,"constructor",d),u(d,"constructor",p),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),u(m,s,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),E(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;E(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function ke(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function Ee(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Se(n.key),n)}}function Se(t){var e=function(t){if("object"!=be(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=be(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==be(e)?e:e+""}const _e=function(){return e=function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.apiService=c.default,this.authService=h,this.urlParser=t,this.story=null},r=[{key:"isUserAuthenticated",value:function(){return this.authService.isLoggedIn()}},{key:"getStoryIdFromUrl",value:function(){return this.urlParser.parseActiveUrlWithoutCombiner().id}},{key:"fetchStoryById",value:(n=xe().mark((function t(e){var r;return xe().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.isUserAuthenticated()){t.next=3;break}throw new Error("Authentication required");case 3:return t.next=5,this.apiService.getStoryById(e);case 5:if(!(r=t.sent).error){t.next=11;break}if(!r.message||!r.message.includes("token")&&!r.message.includes("unauthorized")){t.next=10;break}throw this.authService.logout(),new Error("Authentication expired");case 10:throw new Error(r.message);case 11:return this.story=r.story,t.abrupt("return",{success:!0,data:this.story});case 15:return t.prev=15,t.t0=t.catch(0),t.abrupt("return",{success:!1,error:t.t0.message||"Failed to fetch story details",isAuthError:"Authentication required"===t.t0.message||"Authentication expired"===t.t0.message||t.t0.message.includes("token")||t.t0.message.includes("unauthorized")});case 18:case"end":return t.stop()}}),t,this,[[0,15]])})),o=function(){var t=this,e=arguments;return new Promise((function(r,o){var i=n.apply(t,e);function a(t){ke(i,r,o,a,s,"next",t)}function s(t){ke(i,r,o,a,s,"throw",t)}a(void 0)}))},function(t){return o.apply(this,arguments)})},{key:"formatDate",value:function(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}},{key:"truncateText",value:function(t,e){return t?t.length>e?t.substring(0,e)+"...":t:""}},{key:"hasLocation",value:function(){return this.story&&this.story.lat&&this.story.lon}},{key:"getLocation",value:function(){return this.hasLocation()?{lat:parseFloat(this.story.lat),lon:parseFloat(this.story.lon),name:this.story.name||"Anonymous"}:null}},{key:"logoutUser",value:function(){this.authService.logout()}},{key:"getCurrentStory",value:function(){return this.story}}],r&&Ee(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,n,o}();function Oe(t){return Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oe(t)}function Pe(){Pe=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=x(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new S(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==r&&n.call(g,i)&&(v=g);var m=d.prototype=f.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==Oe(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function x(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function k(t){this.tryEntries.push(t)}function E(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(Oe(e)+" is not iterable")}return p.prototype=d,u(m,"constructor",d),u(d,"constructor",p),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),u(m,s,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),E(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;E(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function je(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function Te(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){je(i,n,o,a,s,"next",t)}function s(t){je(i,n,o,a,s,"throw",t)}a(void 0)}))}}const Le={"/":lt,"/home":lt,"/login":Pt,"/register":Yt,"/add-story":fe,"/story/:id":{presenter:null,model:null,map:null,render:function(){return Te(Pe().mark((function t(){return Pe().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n      <div id="story-detail-content">\n        <div class="loading">\n          <div class="spinner" aria-hidden="true"></div>\n          <span>Loading story details...</span>\n        </div>\n      </div>\n    ');case 1:case"end":return t.stop()}}),t)})))()},afterRender:function(){var t=this;return Te(Pe().mark((function e(){return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.model=new _e,t.presenter=new we(t,t.model),e.next=4,t.presenter.init();case 4:case"end":return e.stop()}}),e)})))()},destroy:function(){this.presenter&&this.presenter.cleanup()},renderAuthenticationRequired:function(){var t=document.querySelector("#story-detail-content");t&&(t.innerHTML='\n      <div class="form-container">\n        <h2 class="form-title">Authentication Required</h2>\n        <div class="message error">\n          <i class="fas fa-lock" aria-hidden="true"></i>\n          You need to login to view story details.\n        </div>\n        <div style="text-align: center; margin-top: 2rem;">\n          <a href="#/login" class="btn">\n            <i class="fas fa-sign-in-alt" aria-hidden="true"></i>\n            Login\n          </a>\n          <a href="#/home" class="btn btn-secondary" style="margin-left: 1rem;">\n            <i class="fas fa-home" aria-hidden="true"></i>\n            Go Home\n          </a>\n        </div>\n      </div>\n    ')},renderStoryDetail:function(t){var e=this,r=document.querySelector("#story-detail-content");if(r){r.innerHTML='\n      <div class="story-detail-container">\n        <div class="story-detail-header">\n          <h1 class="story-detail-title">Story by '.concat(t.name||"Anonymous",'</h1>\n          <div class="story-date" style="text-align: center; color: #666; margin-bottom: 2rem;">\n            <i class="fas fa-calendar-alt" aria-hidden="true"></i>\n            <time datetime="').concat(t.createdAt,'">\n              ').concat(this.presenter.formatDate(t.createdAt),'\n            </time>\n          </div>\n        </div>\n\n        <div class="story-detail-content">\n          <img \n            src="').concat(t.photoUrl,'" \n            alt="Story image by ').concat(t.name||"Anonymous",'"\n            class="story-detail-image"\n          />\n\n          <div class="story-detail-description">\n            <p class="truncate-multiline">').concat(t.description,"</p>\n          </div>\n\n          ").concat(t.lat&&t.lon?'\n            <div class="map-container">\n              <div class="map-header">\n                <h3 class="map-title">\n                  <i class="fas fa-map-marker-alt" aria-hidden="true"></i>\n                  Story Location\n                </h3>\n                <p class="map-subtitle">\n                  Coordinates: '.concat(parseFloat(t.lat).toFixed(4),", ").concat(parseFloat(t.lon).toFixed(4),'\n                </p>\n              </div>\n              <div id="story-map" class="story-detail-map" aria-label="Map showing story location"></div>\n            </div>\n          '):"",'\n\n          <div style="text-align: center; margin-top: 2rem;">\n            <button id="backToStoriesButton" class="btn">\n              <i class="fas fa-arrow-left" aria-hidden="true"></i>\n              Back to Stories\n            </button>\n          </div>\n        </div>\n      </div>\n    ');var n=document.querySelector("#backToStoriesButton");n&&n.addEventListener("click",(function(){e.presenter.onBackToStories()}))}},showError:function(t){var e=this,r=document.querySelector("#story-detail-content");if(r){r.innerHTML='\n      <div class="form-container">\n        <h2 class="form-title">Error</h2>\n        <div class="message error">\n          <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>\n          '.concat(t,'\n        </div>\n        <div style="text-align: center; margin-top: 2rem;">\n          <button id="goHomeButton" class="btn">\n            <i class="fas fa-home" aria-hidden="true"></i>\n            Go Home\n          </button>\n        </div>\n      </div>\n    ');var n=document.querySelector("#goHomeButton");n&&n.addEventListener("click",(function(){e.navigateToHome()}))}},showLoading:function(){var t=document.querySelector("#story-detail-content");t&&(t.innerHTML='\n      <div class="loading">\n        <div class="spinner" aria-hidden="true"></div>\n        <span>Loading story details...</span>\n      </div>\n    ')},initializeStoryMap:function(t,e,r){var n=this;setTimeout((function(){document.querySelector("#story-map")&&(n.map&&(n.map.remove(),n.map=null),n.map=L.map("story-map").setView([t,e],13),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(n.map),L.marker([t,e]).addTo(n.map).bindPopup('\n          <div style="text-align: center;">\n            <h4 style="margin: 0 0 8px 0;">'.concat(r,'\'s Story</h4>\n            <p style="margin: 0; font-size: 12px; color: #666;">\n              ').concat(t.toFixed(4),", ").concat(e.toFixed(4),"\n            </p>\n          </div>\n          ")).openPopup())}),100)},cleanupMap:function(){this.map&&(this.map.remove(),this.map=null)},redirectToLogin:function(){window.location.hash="#/login"},redirectToLoginAfterDelay:function(t){setTimeout((function(){window.location.hash="#/login"}),t)},navigateToHome:function(){window.location.hash="#/home"},redirectToHomeAfterDelay:function(t){setTimeout((function(){window.location.hash="#/home"}),t)}}};function Fe(t){return Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fe(t)}function Ae(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ne(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ae(Object(r),!0).forEach((function(e){Ge(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ae(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Ie(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,De(n.key),n)}}function Ge(t,e,r){return(e=De(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function De(t){var e=function(t){if("object"!=Fe(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Fe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Fe(e)?e:e+""}var Ce=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"_throttledWrite",value:function(t,e){var r=this;this._writeThrottle.has(t)&&clearTimeout(this._writeThrottle.get(t));var n=setTimeout((function(){try{localStorage.setItem(t,e),r._writeThrottle.delete(t)}catch(e){console.error("Failed to write to localStorage: ".concat(t),e)}}),this._throttleDelay);this._writeThrottle.set(t,n)}},{key:"_safeRead",value:function(t){try{return localStorage.getItem(t)}catch(e){return console.error("Failed to read from localStorage: ".concat(t),e),null}}},{key:"_safeRemove",value:function(t){try{localStorage.removeItem(t)}catch(e){console.error("Failed to remove from localStorage: ".concat(t),e)}}},{key:"saveToken",value:function(t){if(t)try{localStorage.setItem("auth_token",t)}catch(t){console.error("Failed to save token:",t)}}},{key:"getToken",value:function(){return this._safeRead("auth_token")}},{key:"removeToken",value:function(){this._safeRemove("auth_token")}},{key:"saveUserData",value:function(t){if(t)try{localStorage.setItem("user_data",JSON.stringify(t))}catch(t){console.error("Failed to save user data:",t)}}},{key:"getUserData",value:function(){var t=this._safeRead("user_data");try{return t?JSON.parse(t):null}catch(t){return console.error("Failed to parse user data:",t),null}}},{key:"removeUserData",value:function(){this._safeRemove("user_data")}},{key:"saveStoriesCache",value:function(t){if(t&&Array.isArray(t)){var e={stories:t,timestamp:Date.now(),ttl:3e5};this._throttledWrite("stories_cache",JSON.stringify(e))}}},{key:"getStoriesCache",value:function(){var t=this._safeRead("stories_cache");if(!t)return null;try{var e=JSON.parse(t);return Date.now()-e.timestamp>e.ttl?null:e.stories}catch(t){return console.error("Failed to parse stories cache:",t),this._safeRemove("stories_cache"),null}}},{key:"removeStoriesCache",value:function(){this._safeRemove("stories_cache")}},{key:"saveStoryCache",value:function(t,e){if(t&&e){var r="story_".concat(t),n={story:e,timestamp:Date.now(),ttl:6e5};this._throttledWrite(r,JSON.stringify(n))}}},{key:"getStoryCache",value:function(t){if(!t)return null;var e="story_".concat(t),r=this._safeRead(e);if(!r)return null;try{var n=JSON.parse(r);return Date.now()-n.timestamp>n.ttl?null:n.story}catch(t){return console.error("Failed to parse story cache:",t),this._safeRemove(e),null}}},{key:"savePendingAction",value:function(t){if(t)try{var e=this.getPendingActions(),r=Ne(Ne({},t),{},{id:"".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),timestamp:Date.now()});e.push(r),e.length>50&&e.shift(),localStorage.setItem("pending_actions",JSON.stringify(e))}catch(t){console.error("Failed to save pending action:",t)}}},{key:"getPendingActions",value:function(){try{var t=this._safeRead("pending_actions");return t?JSON.parse(t):[]}catch(t){return console.error("Failed to parse pending actions:",t),[]}}},{key:"removePendingAction",value:function(t){if(t)try{var e=this.getPendingActions().filter((function(e){return e.id!==t}));localStorage.setItem("pending_actions",JSON.stringify(e))}catch(t){console.error("Failed to remove pending action:",t)}}},{key:"clearPendingActions",value:function(){this._safeRemove("pending_actions")}},{key:"setNetworkStatus",value:function(t){var e=this;this._networkStatusDebounce&&clearTimeout(this._networkStatusDebounce),this._networkStatusDebounce=setTimeout((function(){try{e.getNetworkStatus()!==t&&localStorage.setItem("network_status",t.toString())}catch(t){console.error("Failed to set network status:",t)}}),500)}},{key:"getNetworkStatus",value:function(){var t=this._safeRead("network_status");return null===t||"true"===t}},{key:"saveAppSettings",value:function(t){if(t)try{var e=Ne(Ne({},this.getAppSettings()),t);localStorage.setItem("app_settings",JSON.stringify(e))}catch(t){console.error("Failed to save app settings:",t)}}},{key:"getAppSettings",value:function(){try{var t=this._safeRead("app_settings");return t?JSON.parse(t):{theme:"light",notifications:!0,autoSync:!0}}catch(t){return console.error("Failed to parse app settings:",t),{theme:"light",notifications:!0,autoSync:!0}}}},{key:"cleanupExpiredCache",value:function(){var t=this;try{for(var e=Date.now(),r=[],n=0;n<localStorage.length;n++){var o=localStorage.key(n);if(o&&(o.includes("cache")||o.startsWith("story_"))){var i=this._safeRead(o);if(i)try{var a=JSON.parse(i);a.timestamp&&a.ttl&&e-a.timestamp>a.ttl&&r.push(o)}catch(t){r.push(o)}}}r.forEach((function(e){return t._safeRemove(e)})),r.length>0&&console.log("Cleaned up ".concat(r.length," expired cache entries"))}catch(t){console.error("Failed to cleanup expired cache:",t)}}},{key:"clearAllData",value:function(){var t=this;this._writeThrottle.forEach((function(t){return clearTimeout(t)})),this._writeThrottle.clear(),this._networkStatusDebounce&&(clearTimeout(this._networkStatusDebounce),this._networkStatusDebounce=null);try{["auth_token","user_data","stories_cache","pending_actions","network_status"].forEach((function(e){t._safeRemove(e)}));for(var e=[],r=0;r<localStorage.length;r++){var n=localStorage.key(r);n&&n.startsWith("story_")&&e.push(n)}e.forEach((function(e){return t._safeRemove(e)}))}catch(t){console.error("Failed to clear all data:",t)}}},{key:"initCleanup",value:function(){var t=this;setInterval((function(){t.cleanupExpiredCache()}),6e5),setTimeout((function(){t.cleanupExpiredCache()}),3e4)}}],null&&Ie(t.prototype,null),e&&Ie(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();Ge(Ce,"_writeThrottle",new Map),Ge(Ce,"_throttleDelay",1e3),Ge(Ce,"_networkStatusDebounce",null);const qe=Ce;function Me(t){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Me(t)}function Be(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Ve(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ve(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function Ve(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function Re(){Re=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return u(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=x(s,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var c=l(e,r,n);if("normal"===c.type){if(o=n.done?4:2,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=4,n.method="throw",n.arg=c.arg)}}}(e,n,new S(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==r&&n.call(g,i)&&(v=g);var m=d.prototype=f.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var u=l(t[o],t,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==Me(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;u(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function x(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function k(t){this.tryEntries.push(t)}function E(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(Me(e)+" is not iterable")}return p.prototype=d,u(m,"constructor",d),u(d,"constructor",p),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),u(m,s,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,u=i[1],c=i[2];if(-1===i[0])return n("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<u)return this.method="next",this.arg=t,n(u),!0;if(s<c)return n(c),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),E(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;E(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function Ue(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function He(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ue(i,n,o,a,s,"next",t)}function s(t){Ue(i,n,o,a,s,"throw",t)}a(void 0)}))}}function Ye(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ze(n.key),n)}}function ze(t){var e=function(t){if("object"!=Me(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Me(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Me(e)?e:e+""}const We=function(){return e=function t(e){var r=e.content;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._content=r,this._isRendering=!1,this._renderQueue=[],this._initialAppShell(),this._initPWAFeatures()},n=[{key:"_initialAppShell",value:function(){var t=this;this._updateNavigation();var e=document.querySelector("#logout-button");e&&e.addEventListener("click",function(){var e=He(Re().mark((function e(r){return Re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),h.logout(),t._updateNavigation(),window.location.hash="#/home",e.next=6,t.renderPage();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"_initPWAFeatures",value:function(){this._initOfflineSync(),this._initNetworkMonitoring(),this._initBackgroundSync()}},{key:"_initOfflineSync",value:function(){var t=this;window.addEventListener("online",(function(){t._processPendingActions()})),navigator.onLine&&this._processPendingActions()}},{key:"_initNetworkMonitoring",value:function(){var t,e=navigator.onLine,r=function(){var t=navigator.onLine;if(t!==e){e=t,qe.setNetworkStatus(t);var r=document.querySelector("#offline-indicator");r&&(r.style.display=t?"none":"block"),console.log("Network status changed: ".concat(t?"online":"offline"))}},n=function(){t&&clearTimeout(t),t=setTimeout(r,100)};window.addEventListener("online",n),window.addEventListener("offline",n),r()}},{key:"_initBackgroundSync",value:function(){"serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype&&navigator.serviceWorker.ready.then((function(t){console.log("Background sync is available")}))}},{key:"_processPendingActions",value:(l=He(Re().mark((function t(){var e,r,n,o;return Re().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=qe.getPendingActions(),r=Be(e),t.prev=2,r.s();case 4:if((n=r.n()).done){t.next=17;break}return o=n.value,t.prev=6,t.next=9,this._executePendingAction(o);case 9:qe.removePendingAction(o.id),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(6),console.error("Failed to process pending action:",t.t0);case 15:t.next=4;break;case 17:t.next=22;break;case 19:t.prev=19,t.t1=t.catch(2),r.e(t.t1);case 22:return t.prev=22,r.f(),t.finish(22);case 25:case"end":return t.stop()}}),t,this,[[2,19,22,25],[6,12]])}))),function(){return l.apply(this,arguments)})},{key:"_executePendingAction",value:(c=He(Re().mark((function t(e){var n;return Re().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e.type,t.next="ADD_STORY"===t.t0?3:"UPDATE_PROFILE"===t.t0?9:12;break;case 3:return t.next=5,Promise.resolve().then(r.bind(r,900));case 5:return n=t.sent.ApiService,t.next=8,n.addStory(e.data);case 8:return t.abrupt("break",13);case 9:return t.next=11,h.updateProfile(e.data);case 11:return t.abrupt("break",13);case 12:console.warn("Unknown pending action type:",e.type);case 13:case"end":return t.stop()}}),t)}))),function(t){return c.apply(this,arguments)})},{key:"_updateNavigation",value:function(){var t=h.isLoggedIn(),e=document.querySelector("#login-link"),r=document.querySelector("#register-link"),n=document.querySelector("#logout-button");t?(e&&(e.style.display="none"),r&&(r.style.display="none"),n&&(n.style.display="block")):(e&&(e.style.display="block"),r&&(r.style.display="block"),n&&(n.style.display="none"))}},{key:"renderPage",value:(u=He(Re().mark((function t(){var e=this;return Re().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e._renderQueue.push(t),e._processRenderQueue()})));case 1:case"end":return t.stop()}}),t)}))),function(){return u.apply(this,arguments)})},{key:"_processRenderQueue",value:(s=He(Re().mark((function t(){var e,r=this;return Re().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._isRendering&&0!==this._renderQueue.length){t.next=2;break}return t.abrupt("return");case 2:return this._isRendering=!0,e=this._renderQueue.shift(),t.prev=4,t.next=7,this._doRender();case 7:e(),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(4),console.error("Error in render process:",t.t0),e();case 14:return t.prev=14,this._isRendering=!1,this._renderQueue.length>0&&setTimeout((function(){return r._processRenderQueue()}),0),t.finish(14);case 18:case"end":return t.stop()}}),t,this,[[4,10,14,18]])}))),function(){return s.apply(this,arguments)})},{key:"_doRender",value:(a=He(Re().mark((function e(){var r,n,o=this;return Re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._showLoading(),e.prev=1,r=t.parseActiveUrlWithCombiner(),!(n=Le[r])){e.next=20;break}if(!n.requiresAuth||h.isLoggedIn()){e.next=8;break}return window.location.hash="#/login",e.abrupt("return");case 8:if(!("startViewTransition"in document)){e.next=13;break}return e.next=11,document.startViewTransition(He(Re().mark((function t(){return Re().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.render();case 2:return o._content.innerHTML=t.sent,t.next=5,n.afterRender();case 5:case"end":return t.stop()}}),t)})))).finished;case 11:e.next=18;break;case 13:return e.next=15,n.render();case 15:return this._content.innerHTML=e.sent,e.next=18,n.afterRender();case 18:e.next=21;break;case 20:this._content.innerHTML='\n          <div class="form-container">\n            <h2 class="form-title">Page Not Found</h2>\n            <p style="text-align: center; margin-bottom: 2rem;">The page you\'re looking for doesn\'t exist.</p>\n            <div style="text-align: center;">\n              <a href="#/home" class="btn">\n                <i class="fas fa-home"></i> Go Home\n              </a>\n            </div>\n          </div>\n        ';case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(1),console.error("Error rendering page:",e.t0),this._renderOfflineFallback();case 27:return e.prev=27,this._hideLoading(),this._updateNavigation(),e.finish(27);case 31:case"end":return e.stop()}}),e,this,[[1,23,27,31]])}))),function(){return a.apply(this,arguments)})},{key:"_renderOfflineFallback",value:function(){var t=!navigator.onLine;this._content.innerHTML='\n      <div class="form-container">\n        <h2 class="form-title">'.concat(t?"You're Offline":"Error",'</h2>\n        <div class="message ').concat(t?"warning":"error",'">\n          ').concat(t?"Please check your internet connection and try again.":"Something went wrong. Please try again later.",'\n        </div>\n        <div style="text-align: center; margin-top: 1rem;">\n          <a href="#/home" class="btn">\n            <i class="fas fa-home"></i> Go Home\n          </a>\n        </div>\n      </div>\n    ')}},{key:"_showLoading",value:function(){var t=document.querySelector("#loading-indicator");t&&(t.style.display="flex")}},{key:"_hideLoading",value:function(){var t=document.querySelector("#loading-indicator");t&&(t.style.display="none")}},{key:"cacheCurrentPage",value:(i=He(Re().mark((function t(){var e;return Re().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("caches"in window)){t.next=6;break}return t.next=3,caches.open("dicoding-story-pages");case 3:return e=t.sent,t.next=6,e.add(window.location.href);case 6:case"end":return t.stop()}}),t)}))),function(){return i.apply(this,arguments)})},{key:"clearCache",value:(o=He(Re().mark((function t(){var e;return Re().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("caches"in window)){t.next=6;break}return t.next=3,caches.keys();case 3:return e=t.sent,t.next=6,Promise.all(e.map((function(t){return caches.delete(t)})));case 6:case"end":return t.stop()}}),t)}))),function(){return o.apply(this,arguments)})}],n&&Ye(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,o,i,a,s,u,c,l}();r(452);var Je=new We({button:document.querySelector("#menu"),drawer:document.querySelector("#drawer"),content:document.querySelector("#page-container")});window.addEventListener("hashchange",(function(){Je.renderPage()})),window.addEventListener("load",(function(){Je.renderPage()})),"startViewTransition"in document&&window.addEventListener("beforeunload",(function(){document.startViewTransition&&document.startViewTransition()}))})()})();